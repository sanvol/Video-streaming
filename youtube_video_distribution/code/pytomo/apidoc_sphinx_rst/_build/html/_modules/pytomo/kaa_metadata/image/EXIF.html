

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>pytomo.kaa_metadata.image.EXIF &mdash; Pytomo 2.8.6 documentation</title>
    
    <link rel="stylesheet" href="../../../../_static/default.css" type="text/css" />
    <link rel="stylesheet" href="../../../../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../../../',
        VERSION:     '2.8.6',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../../../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../../../_static/doctools.js"></script>
    <link rel="top" title="Pytomo 2.8.6 documentation" href="../../../../index.html" />
    <link rel="up" title="Module code" href="../../../index.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../../../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li><a href="../../../../index.html">Pytomo 2.8.6 documentation</a> &raquo;</li>
          <li><a href="../../../index.html" accesskey="U">Module code</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <h1>Source code for pytomo.kaa_metadata.image.EXIF</h1><div class="highlight"><pre>
<span class="c">#!/usr/bin/env python</span>
<span class="c"># -*- coding: utf-8 -*-</span>
<span class="c">#</span>
<span class="c"># This code was taken from exif-py:</span>
<span class="c"># Library to extract EXIF information from digital camera image files</span>
<span class="c"># http://sourceforge.net/projects/exif-py/</span>
<span class="c">#</span>
<span class="c"># VERSION 1.0.7</span>
<span class="c">#</span>
<span class="c"># Copyright (c) 2002-2007 Gene Cash All rights reserved</span>
<span class="c"># Copyright (c) 2007 Ianaré Sévi All rights reserved</span>
<span class="c">#</span>
<span class="c"># The changes made for kaa_metadata are marked in the code with a</span>
<span class="c"># comment starting with &quot;kaa_metadata addition&quot;. For a complete</span>
<span class="c"># changelog or a newer version see the original homepage.</span>
<span class="c">#</span>
<span class="c"># Redistribution and use in source and binary forms, with or without</span>
<span class="c"># modification, are permitted provided that the following conditions</span>
<span class="c"># are met:</span>
<span class="c">#</span>
<span class="c">#  1. Redistributions of source code must retain the above copyright</span>
<span class="c">#     notice, this list of conditions and the following disclaimer.</span>
<span class="c">#</span>
<span class="c">#  2. Redistributions in binary form must reproduce the above</span>
<span class="c">#     copyright notice, this list of conditions and the following</span>
<span class="c">#     disclaimer in the documentation and/or other materials provided</span>
<span class="c">#     with the distribution.</span>
<span class="c">#</span>
<span class="c">#  3. Neither the name of the authors nor the names of its contributors</span>
<span class="c">#     may be used to endorse or promote products derived from this</span>
<span class="c">#     software without specific prior written permission.</span>
<span class="c">#</span>
<span class="c"># THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS</span>
<span class="c"># &quot;AS IS&quot; AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT</span>
<span class="c"># LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR</span>
<span class="c"># A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT</span>
<span class="c"># OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,</span>
<span class="c"># SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT</span>
<span class="c"># LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,</span>
<span class="c"># DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY</span>
<span class="c"># THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT</span>
<span class="c"># (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE</span>
<span class="c"># OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.</span>
<span class="c">#</span>
<span class="c">#</span>
<span class="c"># ----- See &#39;changes.txt&#39; file for all contributors and changes ----- #</span>
<span class="c">#</span>


<span class="c"># Don&#39;t throw an exception when given an out of range character.</span>
<div class="viewcode-block" id="make_string"><a class="viewcode-back" href="../../../../pytomo.kaa_metadata.image.html#pytomo.kaa_metadata.image.EXIF.make_string">[docs]</a><span class="k">def</span> <span class="nf">make_string</span><span class="p">(</span><span class="n">seq</span><span class="p">):</span>
    <span class="nb">str</span> <span class="o">=</span> <span class="s">&quot;&quot;</span>
    <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">seq</span><span class="p">:</span>
        <span class="c"># Screen out non-printing characters</span>
        <span class="k">if</span> <span class="mi">32</span> <span class="o">&lt;=</span> <span class="n">c</span> <span class="ow">and</span> <span class="n">c</span> <span class="o">&lt;</span> <span class="mi">256</span><span class="p">:</span>
            <span class="nb">str</span> <span class="o">+=</span> <span class="nb">chr</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>
    <span class="c"># If no printing chars</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">str</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">seq</span>
    <span class="k">return</span> <span class="nb">str</span>

<span class="c"># Special version to deal with the code in the first 8 bytes of a user comment.</span></div>
<div class="viewcode-block" id="make_string_uc"><a class="viewcode-back" href="../../../../pytomo.kaa_metadata.image.html#pytomo.kaa_metadata.image.EXIF.make_string_uc">[docs]</a><span class="k">def</span> <span class="nf">make_string_uc</span><span class="p">(</span><span class="n">seq</span><span class="p">):</span>
    <span class="n">code</span> <span class="o">=</span> <span class="n">seq</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">8</span><span class="p">]</span>
    <span class="n">seq</span> <span class="o">=</span> <span class="n">seq</span><span class="p">[</span><span class="mi">8</span><span class="p">:]</span>
    <span class="c"># Of course, this is only correct if ASCII, and the standard explicitly</span>
    <span class="c"># allows JIS and Unicode.</span>
    <span class="k">return</span> <span class="n">make_string</span><span class="p">(</span><span class="n">seq</span><span class="p">)</span>

<span class="c"># field type descriptions as (length, abbreviation, full name) tuples</span></div>
<span class="n">FIELD_TYPES</span> <span class="o">=</span> <span class="p">(</span>
    <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="s">&#39;X&#39;</span><span class="p">,</span> <span class="s">&#39;Proprietary&#39;</span><span class="p">),</span> <span class="c"># no such type</span>
    <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="s">&#39;B&#39;</span><span class="p">,</span> <span class="s">&#39;Byte&#39;</span><span class="p">),</span>
    <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="s">&#39;A&#39;</span><span class="p">,</span> <span class="s">&#39;ASCII&#39;</span><span class="p">),</span>
    <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="s">&#39;S&#39;</span><span class="p">,</span> <span class="s">&#39;Short&#39;</span><span class="p">),</span>
    <span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="s">&#39;L&#39;</span><span class="p">,</span> <span class="s">&#39;Long&#39;</span><span class="p">),</span>
    <span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="s">&#39;R&#39;</span><span class="p">,</span> <span class="s">&#39;Ratio&#39;</span><span class="p">),</span>
    <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="s">&#39;SB&#39;</span><span class="p">,</span> <span class="s">&#39;Signed Byte&#39;</span><span class="p">),</span>
    <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="s">&#39;U&#39;</span><span class="p">,</span> <span class="s">&#39;Undefined&#39;</span><span class="p">),</span>
    <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="s">&#39;SS&#39;</span><span class="p">,</span> <span class="s">&#39;Signed Short&#39;</span><span class="p">),</span>
    <span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="s">&#39;SL&#39;</span><span class="p">,</span> <span class="s">&#39;Signed Long&#39;</span><span class="p">),</span>
    <span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="s">&#39;SR&#39;</span><span class="p">,</span> <span class="s">&#39;Signed Ratio&#39;</span><span class="p">),</span>
    <span class="p">)</span>

<span class="c"># dictionary of main EXIF tag names</span>
<span class="c"># first element of tuple is tag name, optional second element is</span>
<span class="c"># another dictionary giving names to values</span>
<span class="n">EXIF_TAGS</span> <span class="o">=</span> <span class="p">{</span>
    <span class="mh">0x0100</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;ImageWidth&#39;</span><span class="p">,</span> <span class="p">),</span>
    <span class="mh">0x0101</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;ImageLength&#39;</span><span class="p">,</span> <span class="p">),</span>
    <span class="mh">0x0102</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;BitsPerSample&#39;</span><span class="p">,</span> <span class="p">),</span>
    <span class="mh">0x0103</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;Compression&#39;</span><span class="p">,</span>
             <span class="p">{</span><span class="mi">1</span><span class="p">:</span> <span class="s">&#39;Uncompressed TIFF&#39;</span><span class="p">,</span>
              <span class="mi">6</span><span class="p">:</span> <span class="s">&#39;JPEG Compressed&#39;</span><span class="p">}),</span>
    <span class="mh">0x0106</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;PhotometricInterpretation&#39;</span><span class="p">,</span> <span class="p">),</span>
    <span class="mh">0x010A</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;FillOrder&#39;</span><span class="p">,</span> <span class="p">),</span>
    <span class="mh">0x010D</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;DocumentName&#39;</span><span class="p">,</span> <span class="p">),</span>
    <span class="mh">0x010E</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;ImageDescription&#39;</span><span class="p">,</span> <span class="p">),</span>
    <span class="mh">0x010F</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;Make&#39;</span><span class="p">,</span> <span class="p">),</span>
    <span class="mh">0x0110</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;Model&#39;</span><span class="p">,</span> <span class="p">),</span>
    <span class="mh">0x0111</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;StripOffsets&#39;</span><span class="p">,</span> <span class="p">),</span>
    <span class="mh">0x0112</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;Orientation&#39;</span><span class="p">,</span>
             <span class="p">{</span><span class="mi">1</span><span class="p">:</span> <span class="s">&#39;Horizontal (normal)&#39;</span><span class="p">,</span>
              <span class="mi">2</span><span class="p">:</span> <span class="s">&#39;Mirrored horizontal&#39;</span><span class="p">,</span>
              <span class="mi">3</span><span class="p">:</span> <span class="s">&#39;Rotated 180&#39;</span><span class="p">,</span>
              <span class="mi">4</span><span class="p">:</span> <span class="s">&#39;Mirrored vertical&#39;</span><span class="p">,</span>
              <span class="mi">5</span><span class="p">:</span> <span class="s">&#39;Mirrored horizontal then rotated 90 CCW&#39;</span><span class="p">,</span>
              <span class="mi">6</span><span class="p">:</span> <span class="s">&#39;Rotated 90 CW&#39;</span><span class="p">,</span>
              <span class="mi">7</span><span class="p">:</span> <span class="s">&#39;Mirrored horizontal then rotated 90 CW&#39;</span><span class="p">,</span>
              <span class="mi">8</span><span class="p">:</span> <span class="s">&#39;Rotated 90 CCW&#39;</span><span class="p">}),</span>
    <span class="mh">0x0115</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;SamplesPerPixel&#39;</span><span class="p">,</span> <span class="p">),</span>
    <span class="mh">0x0116</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;RowsPerStrip&#39;</span><span class="p">,</span> <span class="p">),</span>
    <span class="mh">0x0117</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;StripByteCounts&#39;</span><span class="p">,</span> <span class="p">),</span>
    <span class="mh">0x011A</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;XResolution&#39;</span><span class="p">,</span> <span class="p">),</span>
    <span class="mh">0x011B</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;YResolution&#39;</span><span class="p">,</span> <span class="p">),</span>
    <span class="mh">0x011C</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;PlanarConfiguration&#39;</span><span class="p">,</span> <span class="p">),</span>
    <span class="mh">0x0128</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;ResolutionUnit&#39;</span><span class="p">,</span>
             <span class="p">{</span><span class="mi">1</span><span class="p">:</span> <span class="s">&#39;Not Absolute&#39;</span><span class="p">,</span>
              <span class="mi">2</span><span class="p">:</span> <span class="s">&#39;Pixels/Inch&#39;</span><span class="p">,</span>
              <span class="mi">3</span><span class="p">:</span> <span class="s">&#39;Pixels/Centimeter&#39;</span><span class="p">}),</span>
    <span class="mh">0x012D</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;TransferFunction&#39;</span><span class="p">,</span> <span class="p">),</span>
    <span class="mh">0x0131</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;Software&#39;</span><span class="p">,</span> <span class="p">),</span>
    <span class="mh">0x0132</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;DateTime&#39;</span><span class="p">,</span> <span class="p">),</span>
    <span class="mh">0x013B</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;Artist&#39;</span><span class="p">,</span> <span class="p">),</span>
    <span class="mh">0x013E</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;WhitePoint&#39;</span><span class="p">,</span> <span class="p">),</span>
    <span class="mh">0x013F</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;PrimaryChromaticities&#39;</span><span class="p">,</span> <span class="p">),</span>
    <span class="mh">0x0156</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;TransferRange&#39;</span><span class="p">,</span> <span class="p">),</span>
    <span class="mh">0x0200</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;JPEGProc&#39;</span><span class="p">,</span> <span class="p">),</span>
    <span class="mh">0x0201</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;JPEGInterchangeFormat&#39;</span><span class="p">,</span> <span class="p">),</span>
    <span class="mh">0x0202</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;JPEGInterchangeFormatLength&#39;</span><span class="p">,</span> <span class="p">),</span>
    <span class="mh">0x0211</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;YCbCrCoefficients&#39;</span><span class="p">,</span> <span class="p">),</span>
    <span class="mh">0x0212</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;YCbCrSubSampling&#39;</span><span class="p">,</span> <span class="p">),</span>
    <span class="mh">0x0213</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;YCbCrPositioning&#39;</span><span class="p">,</span> <span class="p">),</span>
    <span class="mh">0x0214</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;ReferenceBlackWhite&#39;</span><span class="p">,</span> <span class="p">),</span>
    <span class="mh">0x828D</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;CFARepeatPatternDim&#39;</span><span class="p">,</span> <span class="p">),</span>
    <span class="mh">0x828E</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;CFAPattern&#39;</span><span class="p">,</span> <span class="p">),</span>
    <span class="mh">0x828F</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;BatteryLevel&#39;</span><span class="p">,</span> <span class="p">),</span>
    <span class="mh">0x8298</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;Copyright&#39;</span><span class="p">,</span> <span class="p">),</span>
    <span class="mh">0x829A</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;ExposureTime&#39;</span><span class="p">,</span> <span class="p">),</span>
    <span class="mh">0x829D</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;FNumber&#39;</span><span class="p">,</span> <span class="p">),</span>
    <span class="mh">0x83BB</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;IPTC/NAA&#39;</span><span class="p">,</span> <span class="p">),</span>
    <span class="mh">0x8769</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;ExifOffset&#39;</span><span class="p">,</span> <span class="p">),</span>
    <span class="mh">0x8773</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;InterColorProfile&#39;</span><span class="p">,</span> <span class="p">),</span>
    <span class="mh">0x8822</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;ExposureProgram&#39;</span><span class="p">,</span>
             <span class="p">{</span><span class="mi">0</span><span class="p">:</span> <span class="s">&#39;Unidentified&#39;</span><span class="p">,</span>
              <span class="mi">1</span><span class="p">:</span> <span class="s">&#39;Manual&#39;</span><span class="p">,</span>
              <span class="mi">2</span><span class="p">:</span> <span class="s">&#39;Program Normal&#39;</span><span class="p">,</span>
              <span class="mi">3</span><span class="p">:</span> <span class="s">&#39;Aperture Priority&#39;</span><span class="p">,</span>
              <span class="mi">4</span><span class="p">:</span> <span class="s">&#39;Shutter Priority&#39;</span><span class="p">,</span>
              <span class="mi">5</span><span class="p">:</span> <span class="s">&#39;Program Creative&#39;</span><span class="p">,</span>
              <span class="mi">6</span><span class="p">:</span> <span class="s">&#39;Program Action&#39;</span><span class="p">,</span>
              <span class="mi">7</span><span class="p">:</span> <span class="s">&#39;Portrait Mode&#39;</span><span class="p">,</span>
              <span class="mi">8</span><span class="p">:</span> <span class="s">&#39;Landscape Mode&#39;</span><span class="p">}),</span>
    <span class="mh">0x8824</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;SpectralSensitivity&#39;</span><span class="p">,</span> <span class="p">),</span>
    <span class="mh">0x8825</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;GPSInfo&#39;</span><span class="p">,</span> <span class="p">),</span>
    <span class="mh">0x8827</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;ISOSpeedRatings&#39;</span><span class="p">,</span> <span class="p">),</span>
    <span class="mh">0x8828</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;OECF&#39;</span><span class="p">,</span> <span class="p">),</span>
    <span class="c"># print as string</span>
    <span class="mh">0x9000</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;ExifVersion&#39;</span><span class="p">,</span> <span class="n">make_string</span><span class="p">),</span>
    <span class="mh">0x9003</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;DateTimeOriginal&#39;</span><span class="p">,</span> <span class="p">),</span>
    <span class="mh">0x9004</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;DateTimeDigitized&#39;</span><span class="p">,</span> <span class="p">),</span>
    <span class="mh">0x9101</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;ComponentsConfiguration&#39;</span><span class="p">,</span>
             <span class="p">{</span><span class="mi">0</span><span class="p">:</span> <span class="s">&#39;&#39;</span><span class="p">,</span>
              <span class="mi">1</span><span class="p">:</span> <span class="s">&#39;Y&#39;</span><span class="p">,</span>
              <span class="mi">2</span><span class="p">:</span> <span class="s">&#39;Cb&#39;</span><span class="p">,</span>
              <span class="mi">3</span><span class="p">:</span> <span class="s">&#39;Cr&#39;</span><span class="p">,</span>
              <span class="mi">4</span><span class="p">:</span> <span class="s">&#39;Red&#39;</span><span class="p">,</span>
              <span class="mi">5</span><span class="p">:</span> <span class="s">&#39;Green&#39;</span><span class="p">,</span>
              <span class="mi">6</span><span class="p">:</span> <span class="s">&#39;Blue&#39;</span><span class="p">}),</span>
    <span class="mh">0x9102</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;CompressedBitsPerPixel&#39;</span><span class="p">,</span> <span class="p">),</span>
    <span class="mh">0x9201</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;ShutterSpeedValue&#39;</span><span class="p">,</span> <span class="p">),</span>
    <span class="mh">0x9202</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;ApertureValue&#39;</span><span class="p">,</span> <span class="p">),</span>
    <span class="mh">0x9203</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;BrightnessValue&#39;</span><span class="p">,</span> <span class="p">),</span>
    <span class="mh">0x9204</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;ExposureBiasValue&#39;</span><span class="p">,</span> <span class="p">),</span>
    <span class="mh">0x9205</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;MaxApertureValue&#39;</span><span class="p">,</span> <span class="p">),</span>
    <span class="mh">0x9206</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;SubjectDistance&#39;</span><span class="p">,</span> <span class="p">),</span>
    <span class="mh">0x9207</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;MeteringMode&#39;</span><span class="p">,</span>
             <span class="p">{</span><span class="mi">0</span><span class="p">:</span> <span class="s">&#39;Unidentified&#39;</span><span class="p">,</span>
              <span class="mi">1</span><span class="p">:</span> <span class="s">&#39;Average&#39;</span><span class="p">,</span>
              <span class="mi">2</span><span class="p">:</span> <span class="s">&#39;CenterWeightedAverage&#39;</span><span class="p">,</span>
              <span class="mi">3</span><span class="p">:</span> <span class="s">&#39;Spot&#39;</span><span class="p">,</span>
              <span class="mi">4</span><span class="p">:</span> <span class="s">&#39;MultiSpot&#39;</span><span class="p">}),</span>
    <span class="mh">0x9208</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;LightSource&#39;</span><span class="p">,</span>
             <span class="p">{</span><span class="mi">0</span><span class="p">:</span> <span class="s">&#39;Unknown&#39;</span><span class="p">,</span>
              <span class="mi">1</span><span class="p">:</span> <span class="s">&#39;Daylight&#39;</span><span class="p">,</span>
              <span class="mi">2</span><span class="p">:</span> <span class="s">&#39;Fluorescent&#39;</span><span class="p">,</span>
              <span class="mi">3</span><span class="p">:</span> <span class="s">&#39;Tungsten&#39;</span><span class="p">,</span>
              <span class="mi">10</span><span class="p">:</span> <span class="s">&#39;Flash&#39;</span><span class="p">,</span>
              <span class="mi">17</span><span class="p">:</span> <span class="s">&#39;Standard Light A&#39;</span><span class="p">,</span>
              <span class="mi">18</span><span class="p">:</span> <span class="s">&#39;Standard Light B&#39;</span><span class="p">,</span>
              <span class="mi">19</span><span class="p">:</span> <span class="s">&#39;Standard Light C&#39;</span><span class="p">,</span>
              <span class="mi">20</span><span class="p">:</span> <span class="s">&#39;D55&#39;</span><span class="p">,</span>
              <span class="mi">21</span><span class="p">:</span> <span class="s">&#39;D65&#39;</span><span class="p">,</span>
              <span class="mi">22</span><span class="p">:</span> <span class="s">&#39;D75&#39;</span><span class="p">,</span>
              <span class="mi">255</span><span class="p">:</span> <span class="s">&#39;Other&#39;</span><span class="p">}),</span>
    <span class="mh">0x9209</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;Flash&#39;</span><span class="p">,</span> <span class="p">{</span><span class="mi">0</span><span class="p">:</span> <span class="s">&#39;No&#39;</span><span class="p">,</span>
                       <span class="mi">1</span><span class="p">:</span> <span class="s">&#39;Fired&#39;</span><span class="p">,</span>
                       <span class="mi">5</span><span class="p">:</span> <span class="s">&#39;Fired (?)&#39;</span><span class="p">,</span> <span class="c"># no return sensed</span>
                       <span class="mi">7</span><span class="p">:</span> <span class="s">&#39;Fired (!)&#39;</span><span class="p">,</span> <span class="c"># return sensed</span>
                       <span class="mi">9</span><span class="p">:</span> <span class="s">&#39;Fill Fired&#39;</span><span class="p">,</span>
                       <span class="mi">13</span><span class="p">:</span> <span class="s">&#39;Fill Fired (?)&#39;</span><span class="p">,</span>
                       <span class="mi">15</span><span class="p">:</span> <span class="s">&#39;Fill Fired (!)&#39;</span><span class="p">,</span>
                       <span class="mi">16</span><span class="p">:</span> <span class="s">&#39;Off&#39;</span><span class="p">,</span>
                       <span class="mi">24</span><span class="p">:</span> <span class="s">&#39;Auto Off&#39;</span><span class="p">,</span>
                       <span class="mi">25</span><span class="p">:</span> <span class="s">&#39;Auto Fired&#39;</span><span class="p">,</span>
                       <span class="mi">29</span><span class="p">:</span> <span class="s">&#39;Auto Fired (?)&#39;</span><span class="p">,</span>
                       <span class="mi">31</span><span class="p">:</span> <span class="s">&#39;Auto Fired (!)&#39;</span><span class="p">,</span>
                       <span class="mi">32</span><span class="p">:</span> <span class="s">&#39;Not Available&#39;</span><span class="p">}),</span>
    <span class="mh">0x920A</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;FocalLength&#39;</span><span class="p">,</span> <span class="p">),</span>
    <span class="mh">0x9214</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;SubjectArea&#39;</span><span class="p">,</span> <span class="p">),</span>
    <span class="mh">0x927C</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;MakerNote&#39;</span><span class="p">,</span> <span class="p">),</span>
    <span class="c"># print as string</span>
    <span class="mh">0x9286</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;UserComment&#39;</span><span class="p">,</span> <span class="n">make_string_uc</span><span class="p">),</span>  <span class="c"># First 8 bytes gives coding system e.g. ASCII vs. JIS vs Unicode</span>
    <span class="mh">0x9290</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;SubSecTime&#39;</span><span class="p">,</span> <span class="p">),</span>
    <span class="mh">0x9291</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;SubSecTimeOriginal&#39;</span><span class="p">,</span> <span class="p">),</span>
    <span class="mh">0x9292</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;SubSecTimeDigitized&#39;</span><span class="p">,</span> <span class="p">),</span>
    <span class="c"># print as string</span>
    <span class="mh">0xA000</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;FlashPixVersion&#39;</span><span class="p">,</span> <span class="n">make_string</span><span class="p">),</span>
    <span class="mh">0xA001</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;ColorSpace&#39;</span><span class="p">,</span> <span class="p">),</span>
    <span class="mh">0xA002</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;ExifImageWidth&#39;</span><span class="p">,</span> <span class="p">),</span>
    <span class="mh">0xA003</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;ExifImageLength&#39;</span><span class="p">,</span> <span class="p">),</span>
    <span class="mh">0xA005</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;InteroperabilityOffset&#39;</span><span class="p">,</span> <span class="p">),</span>
    <span class="mh">0xA20B</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;FlashEnergy&#39;</span><span class="p">,</span> <span class="p">),</span>               <span class="c"># 0x920B in TIFF/EP</span>
    <span class="mh">0xA20C</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;SpatialFrequencyResponse&#39;</span><span class="p">,</span> <span class="p">),</span>  <span class="c"># 0x920C    -  -</span>
    <span class="mh">0xA20E</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;FocalPlaneXResolution&#39;</span><span class="p">,</span> <span class="p">),</span>     <span class="c"># 0x920E    -  -</span>
    <span class="mh">0xA20F</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;FocalPlaneYResolution&#39;</span><span class="p">,</span> <span class="p">),</span>     <span class="c"># 0x920F    -  -</span>
    <span class="mh">0xA210</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;FocalPlaneResolutionUnit&#39;</span><span class="p">,</span> <span class="p">),</span>  <span class="c"># 0x9210    -  -</span>
    <span class="mh">0xA214</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;SubjectLocation&#39;</span><span class="p">,</span> <span class="p">),</span>           <span class="c"># 0x9214    -  -</span>
    <span class="mh">0xA215</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;ExposureIndex&#39;</span><span class="p">,</span> <span class="p">),</span>             <span class="c"># 0x9215    -  -</span>
    <span class="mh">0xA217</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;SensingMethod&#39;</span><span class="p">,</span> <span class="p">),</span>             <span class="c"># 0x9217    -  -</span>
    <span class="mh">0xA300</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;FileSource&#39;</span><span class="p">,</span>
             <span class="p">{</span><span class="mi">3</span><span class="p">:</span> <span class="s">&#39;Digital Camera&#39;</span><span class="p">}),</span>
    <span class="mh">0xA301</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;SceneType&#39;</span><span class="p">,</span>
             <span class="p">{</span><span class="mi">1</span><span class="p">:</span> <span class="s">&#39;Directly Photographed&#39;</span><span class="p">}),</span>
    <span class="mh">0xA302</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;CVAPattern&#39;</span><span class="p">,</span> <span class="p">),</span>
    <span class="mh">0xA401</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;CustomRendered&#39;</span><span class="p">,</span> <span class="p">),</span>
    <span class="mh">0xA402</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;ExposureMode&#39;</span><span class="p">,</span>
             <span class="p">{</span><span class="mi">0</span><span class="p">:</span> <span class="s">&#39;Auto Exposure&#39;</span><span class="p">,</span>
              <span class="mi">1</span><span class="p">:</span> <span class="s">&#39;Manual Exposure&#39;</span><span class="p">,</span>
              <span class="mi">2</span><span class="p">:</span> <span class="s">&#39;Auto Bracket&#39;</span><span class="p">}),</span>
    <span class="mh">0xA403</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;WhiteBalance&#39;</span><span class="p">,</span>
             <span class="p">{</span><span class="mi">0</span><span class="p">:</span> <span class="s">&#39;Auto&#39;</span><span class="p">,</span>
              <span class="mi">1</span><span class="p">:</span> <span class="s">&#39;Manual&#39;</span><span class="p">}),</span>
    <span class="mh">0xA404</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;DigitalZoomRatio&#39;</span><span class="p">,</span> <span class="p">),</span>
    <span class="mh">0xA405</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;FocalLengthIn35mm&#39;</span><span class="p">,</span> <span class="p">),</span>
    <span class="mh">0xA406</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;SceneCaptureType&#39;</span><span class="p">,</span> <span class="p">),</span>
    <span class="mh">0xA407</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;GainControl&#39;</span><span class="p">,</span> <span class="p">),</span>
    <span class="mh">0xA408</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;Contrast&#39;</span><span class="p">,</span> <span class="p">),</span>
    <span class="mh">0xA409</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;Saturation&#39;</span><span class="p">,</span> <span class="p">),</span>
    <span class="mh">0xA40A</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;Sharpness&#39;</span><span class="p">,</span> <span class="p">),</span>
    <span class="mh">0xA40C</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;SubjectDistanceRange&#39;</span><span class="p">,</span> <span class="p">),</span>
    <span class="p">}</span>

<span class="c"># interoperability tags</span>
<span class="n">INTR_TAGS</span> <span class="o">=</span> <span class="p">{</span>
    <span class="mh">0x0001</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;InteroperabilityIndex&#39;</span><span class="p">,</span> <span class="p">),</span>
    <span class="mh">0x0002</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;InteroperabilityVersion&#39;</span><span class="p">,</span> <span class="p">),</span>
    <span class="mh">0x1000</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;RelatedImageFileFormat&#39;</span><span class="p">,</span> <span class="p">),</span>
    <span class="mh">0x1001</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;RelatedImageWidth&#39;</span><span class="p">,</span> <span class="p">),</span>
    <span class="mh">0x1002</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;RelatedImageLength&#39;</span><span class="p">,</span> <span class="p">),</span>
    <span class="p">}</span>

<span class="c"># GPS tags (not used yet, haven&#39;t seen camera with GPS)</span>
<span class="n">GPS_TAGS</span> <span class="o">=</span> <span class="p">{</span>
    <span class="mh">0x0000</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;GPSVersionID&#39;</span><span class="p">,</span> <span class="p">),</span>
    <span class="mh">0x0001</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;GPSLatitudeRef&#39;</span><span class="p">,</span> <span class="p">),</span>
    <span class="mh">0x0002</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;GPSLatitude&#39;</span><span class="p">,</span> <span class="p">),</span>
    <span class="mh">0x0003</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;GPSLongitudeRef&#39;</span><span class="p">,</span> <span class="p">),</span>
    <span class="mh">0x0004</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;GPSLongitude&#39;</span><span class="p">,</span> <span class="p">),</span>
    <span class="mh">0x0005</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;GPSAltitudeRef&#39;</span><span class="p">,</span> <span class="p">),</span>
    <span class="mh">0x0006</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;GPSAltitude&#39;</span><span class="p">,</span> <span class="p">),</span>
    <span class="mh">0x0007</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;GPSTimeStamp&#39;</span><span class="p">,</span> <span class="p">),</span>
    <span class="mh">0x0008</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;GPSSatellites&#39;</span><span class="p">,</span> <span class="p">),</span>
    <span class="mh">0x0009</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;GPSStatus&#39;</span><span class="p">,</span> <span class="p">),</span>
    <span class="mh">0x000A</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;GPSMeasureMode&#39;</span><span class="p">,</span> <span class="p">),</span>
    <span class="mh">0x000B</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;GPSDOP&#39;</span><span class="p">,</span> <span class="p">),</span>
    <span class="mh">0x000C</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;GPSSpeedRef&#39;</span><span class="p">,</span> <span class="p">),</span>
    <span class="mh">0x000D</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;GPSSpeed&#39;</span><span class="p">,</span> <span class="p">),</span>
    <span class="mh">0x000E</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;GPSTrackRef&#39;</span><span class="p">,</span> <span class="p">),</span>
    <span class="mh">0x000F</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;GPSTrack&#39;</span><span class="p">,</span> <span class="p">),</span>
    <span class="mh">0x0010</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;GPSImgDirectionRef&#39;</span><span class="p">,</span> <span class="p">),</span>
    <span class="mh">0x0011</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;GPSImgDirection&#39;</span><span class="p">,</span> <span class="p">),</span>
    <span class="mh">0x0012</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;GPSMapDatum&#39;</span><span class="p">,</span> <span class="p">),</span>
    <span class="mh">0x0013</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;GPSDestLatitudeRef&#39;</span><span class="p">,</span> <span class="p">),</span>
    <span class="mh">0x0014</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;GPSDestLatitude&#39;</span><span class="p">,</span> <span class="p">),</span>
    <span class="mh">0x0015</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;GPSDestLongitudeRef&#39;</span><span class="p">,</span> <span class="p">),</span>
    <span class="mh">0x0016</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;GPSDestLongitude&#39;</span><span class="p">,</span> <span class="p">),</span>
    <span class="mh">0x0017</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;GPSDestBearingRef&#39;</span><span class="p">,</span> <span class="p">),</span>
    <span class="mh">0x0018</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;GPSDestBearing&#39;</span><span class="p">,</span> <span class="p">),</span>
    <span class="mh">0x0019</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;GPSDestDistanceRef&#39;</span><span class="p">,</span> <span class="p">),</span>
    <span class="mh">0x001A</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;GPSDestDistance&#39;</span><span class="p">,</span> <span class="p">),</span>
    <span class="p">}</span>

<span class="c"># Ignore these tags when quick processing</span>
<span class="c"># 0x927C is MakerNote Tags</span>
<span class="c"># 0x9286 is user comment</span>
<span class="n">IGNORE_TAGS</span><span class="o">=</span><span class="p">(</span><span class="mh">0x9286</span><span class="p">,</span> <span class="mh">0x927C</span><span class="p">)</span>

<span class="c"># http://tomtia.plala.jp/DigitalCamera/MakerNote/index.asp</span>
<div class="viewcode-block" id="nikon_ev_bias"><a class="viewcode-back" href="../../../../pytomo.kaa_metadata.image.html#pytomo.kaa_metadata.image.EXIF.nikon_ev_bias">[docs]</a><span class="k">def</span> <span class="nf">nikon_ev_bias</span><span class="p">(</span><span class="n">seq</span><span class="p">):</span>
    <span class="c"># First digit seems to be in steps of 1/6 EV.</span>
    <span class="c"># Does the third value mean the step size?  It is usually 6,</span>
    <span class="c"># but it is 12 for the ExposureDifference.</span>
    <span class="c">#</span>
    <span class="k">if</span> <span class="n">seq</span> <span class="o">==</span> <span class="p">[</span><span class="mi">252</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">0</span><span class="p">]:</span>
        <span class="k">return</span> <span class="s">&quot;-2/3 EV&quot;</span>
    <span class="k">if</span> <span class="n">seq</span> <span class="o">==</span> <span class="p">[</span><span class="mi">253</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">0</span><span class="p">]:</span>
        <span class="k">return</span> <span class="s">&quot;-1/2 EV&quot;</span>
    <span class="k">if</span> <span class="n">seq</span> <span class="o">==</span> <span class="p">[</span><span class="mi">254</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">0</span><span class="p">]:</span>
        <span class="k">return</span> <span class="s">&quot;-1/3 EV&quot;</span>
    <span class="k">if</span> <span class="n">seq</span> <span class="o">==</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">0</span><span class="p">]:</span>
        <span class="k">return</span> <span class="s">&quot;0 EV&quot;</span>
    <span class="k">if</span> <span class="n">seq</span> <span class="o">==</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">0</span><span class="p">]:</span>
        <span class="k">return</span> <span class="s">&quot;+1/3 EV&quot;</span>
    <span class="k">if</span> <span class="n">seq</span> <span class="o">==</span> <span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">0</span><span class="p">]:</span>
        <span class="k">return</span> <span class="s">&quot;+1/2 EV&quot;</span>
    <span class="k">if</span> <span class="n">seq</span> <span class="o">==</span> <span class="p">[</span><span class="mi">4</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">0</span><span class="p">]:</span>
        <span class="k">return</span> <span class="s">&quot;+2/3 EV&quot;</span>
    <span class="c"># Handle combinations not in the table.</span>
    <span class="n">a</span> <span class="o">=</span> <span class="n">seq</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="c"># Causes headaches for the +/- logic, so special case it.</span>
    <span class="k">if</span> <span class="n">a</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">return</span> <span class="s">&quot;0 EV&quot;</span>
    <span class="k">if</span> <span class="n">a</span> <span class="o">&gt;</span> <span class="mi">127</span><span class="p">:</span>
        <span class="n">a</span> <span class="o">=</span> <span class="mi">256</span> <span class="o">-</span> <span class="n">a</span>
        <span class="n">ret_str</span> <span class="o">=</span> <span class="s">&quot;-&quot;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">ret_str</span> <span class="o">=</span> <span class="s">&quot;+&quot;</span>
    <span class="n">b</span> <span class="o">=</span> <span class="n">seq</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>	<span class="c"># Assume third value means the step size</span>
    <span class="n">whole</span> <span class="o">=</span> <span class="n">a</span> <span class="o">/</span> <span class="n">b</span>
    <span class="n">a</span> <span class="o">=</span> <span class="n">a</span> <span class="o">%</span> <span class="n">b</span>
    <span class="k">if</span> <span class="n">whole</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">ret_str</span> <span class="o">=</span> <span class="n">ret_str</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">whole</span><span class="p">)</span> <span class="o">+</span> <span class="s">&quot; &quot;</span>
    <span class="k">if</span> <span class="n">a</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">ret_str</span> <span class="o">=</span> <span class="n">ret_str</span> <span class="o">+</span> <span class="s">&quot;EV&quot;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">r</span> <span class="o">=</span> <span class="n">Ratio</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span>
        <span class="n">ret_str</span> <span class="o">=</span> <span class="n">ret_str</span> <span class="o">+</span> <span class="n">r</span><span class="o">.</span><span class="n">__repr__</span><span class="p">()</span> <span class="o">+</span> <span class="s">&quot; EV&quot;</span>
    <span class="k">return</span> <span class="n">ret_str</span>

<span class="c"># Nikon E99x MakerNote Tags</span></div>
<span class="n">MAKERNOTE_NIKON_NEWER_TAGS</span><span class="o">=</span><span class="p">{</span>
    <span class="mh">0x0001</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;MakernoteVersion&#39;</span><span class="p">,</span> <span class="n">make_string</span><span class="p">),</span>	<span class="c"># Sometimes binary</span>
    <span class="mh">0x0002</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;ISOSetting&#39;</span><span class="p">,</span> <span class="p">),</span>
    <span class="mh">0x0003</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;ColorMode&#39;</span><span class="p">,</span> <span class="p">),</span>
    <span class="mh">0x0004</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;Quality&#39;</span><span class="p">,</span> <span class="p">),</span>
    <span class="mh">0x0005</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;Whitebalance&#39;</span><span class="p">,</span> <span class="p">),</span>
    <span class="mh">0x0006</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;ImageSharpening&#39;</span><span class="p">,</span> <span class="p">),</span>
    <span class="mh">0x0007</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;FocusMode&#39;</span><span class="p">,</span> <span class="p">),</span>
    <span class="mh">0x0008</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;FlashSetting&#39;</span><span class="p">,</span> <span class="p">),</span>
    <span class="mh">0x0009</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;AutoFlashMode&#39;</span><span class="p">,</span> <span class="p">),</span>
    <span class="mh">0x000B</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;WhiteBalanceBias&#39;</span><span class="p">,</span> <span class="p">),</span>
    <span class="mh">0x000C</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;WhiteBalanceRBCoeff&#39;</span><span class="p">,</span> <span class="p">),</span>
    <span class="mh">0x000D</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;ProgramShift&#39;</span><span class="p">,</span> <span class="n">nikon_ev_bias</span><span class="p">),</span>
    <span class="c"># Nearly the same as the other EV vals, but step size is 1/12 EV (?)</span>
    <span class="mh">0x000E</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;ExposureDifference&#39;</span><span class="p">,</span> <span class="n">nikon_ev_bias</span><span class="p">),</span>
    <span class="mh">0x000F</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;ISOSelection&#39;</span><span class="p">,</span> <span class="p">),</span>
    <span class="mh">0x0011</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;NikonPreview&#39;</span><span class="p">,</span> <span class="p">),</span>
    <span class="mh">0x0012</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;FlashCompensation&#39;</span><span class="p">,</span> <span class="n">nikon_ev_bias</span><span class="p">),</span>
    <span class="mh">0x0013</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;ISOSpeedRequested&#39;</span><span class="p">,</span> <span class="p">),</span>
    <span class="mh">0x0016</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;PhotoCornerCoordinates&#39;</span><span class="p">,</span> <span class="p">),</span>
    <span class="c"># 0x0017: Unknown, but most likely an EV value</span>
    <span class="mh">0x0018</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;FlashBracketCompensationApplied&#39;</span><span class="p">,</span> <span class="n">nikon_ev_bias</span><span class="p">),</span>
    <span class="mh">0x0019</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;AEBracketCompensationApplied&#39;</span><span class="p">,</span> <span class="p">),</span>
    <span class="mh">0x001A</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;ImageProcessing&#39;</span><span class="p">,</span> <span class="p">),</span>
    <span class="mh">0x0080</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;ImageAdjustment&#39;</span><span class="p">,</span> <span class="p">),</span>
    <span class="mh">0x0081</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;ToneCompensation&#39;</span><span class="p">,</span> <span class="p">),</span>
    <span class="mh">0x0082</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;AuxiliaryLens&#39;</span><span class="p">,</span> <span class="p">),</span>
    <span class="mh">0x0083</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;LensType&#39;</span><span class="p">,</span> <span class="p">),</span>
    <span class="mh">0x0084</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;LensMinMaxFocalMaxAperture&#39;</span><span class="p">,</span> <span class="p">),</span>
    <span class="mh">0x0085</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;ManualFocusDistance&#39;</span><span class="p">,</span> <span class="p">),</span>
    <span class="mh">0x0086</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;DigitalZoomFactor&#39;</span><span class="p">,</span> <span class="p">),</span>
    <span class="mh">0x0087</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;FlashMode&#39;</span><span class="p">,</span>
             <span class="p">{</span><span class="mh">0x00</span><span class="p">:</span> <span class="s">&#39;Did Not Fire&#39;</span><span class="p">,</span>
              <span class="mh">0x01</span><span class="p">:</span> <span class="s">&#39;Fired, Manual&#39;</span><span class="p">,</span>
              <span class="mh">0x07</span><span class="p">:</span> <span class="s">&#39;Fired, External&#39;</span><span class="p">,</span>
              <span class="mh">0x08</span><span class="p">:</span> <span class="s">&#39;Fired, Commander Mode &#39;</span><span class="p">,</span>
              <span class="mh">0x09</span><span class="p">:</span> <span class="s">&#39;Fired, TTL Mode&#39;</span><span class="p">}),</span>
    <span class="mh">0x0088</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;AFFocusPosition&#39;</span><span class="p">,</span>
             <span class="p">{</span><span class="mh">0x0000</span><span class="p">:</span> <span class="s">&#39;Center&#39;</span><span class="p">,</span>
              <span class="mh">0x0100</span><span class="p">:</span> <span class="s">&#39;Top&#39;</span><span class="p">,</span>
              <span class="mh">0x0200</span><span class="p">:</span> <span class="s">&#39;Bottom&#39;</span><span class="p">,</span>
              <span class="mh">0x0300</span><span class="p">:</span> <span class="s">&#39;Left&#39;</span><span class="p">,</span>
              <span class="mh">0x0400</span><span class="p">:</span> <span class="s">&#39;Right&#39;</span><span class="p">}),</span>
    <span class="mh">0x0089</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;BracketingMode&#39;</span><span class="p">,</span>
             <span class="p">{</span><span class="mh">0x00</span><span class="p">:</span> <span class="s">&#39;Single frame, no bracketing&#39;</span><span class="p">,</span>
              <span class="mh">0x01</span><span class="p">:</span> <span class="s">&#39;Continuous, no bracketing&#39;</span><span class="p">,</span>
              <span class="mh">0x02</span><span class="p">:</span> <span class="s">&#39;Timer, no bracketing&#39;</span><span class="p">,</span>
              <span class="mh">0x10</span><span class="p">:</span> <span class="s">&#39;Single frame, exposure bracketing&#39;</span><span class="p">,</span>
              <span class="mh">0x11</span><span class="p">:</span> <span class="s">&#39;Continuous, exposure bracketing&#39;</span><span class="p">,</span>
              <span class="mh">0x12</span><span class="p">:</span> <span class="s">&#39;Timer, exposure bracketing&#39;</span><span class="p">,</span>
              <span class="mh">0x40</span><span class="p">:</span> <span class="s">&#39;Single frame, white balance bracketing&#39;</span><span class="p">,</span>
              <span class="mh">0x41</span><span class="p">:</span> <span class="s">&#39;Continuous, white balance bracketing&#39;</span><span class="p">,</span>
              <span class="mh">0x42</span><span class="p">:</span> <span class="s">&#39;Timer, white balance bracketing&#39;</span><span class="p">}),</span>
    <span class="mh">0x008A</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;AutoBracketRelease&#39;</span><span class="p">,</span> <span class="p">),</span>
    <span class="mh">0x008B</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;LensFStops&#39;</span><span class="p">,</span> <span class="p">),</span>
    <span class="mh">0x008C</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;NEFCurve2&#39;</span><span class="p">,</span> <span class="p">),</span>
    <span class="mh">0x008D</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;ColorMode&#39;</span><span class="p">,</span> <span class="p">),</span>
    <span class="mh">0x008F</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;SceneMode&#39;</span><span class="p">,</span> <span class="p">),</span>
    <span class="mh">0x0090</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;LightingType&#39;</span><span class="p">,</span> <span class="p">),</span>
    <span class="mh">0x0091</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;ShotInfo&#39;</span><span class="p">,</span> <span class="p">),</span>	<span class="c"># First 4 bytes are probably a version number in ASCII</span>
    <span class="mh">0x0092</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;HueAdjustment&#39;</span><span class="p">,</span> <span class="p">),</span>
    <span class="c"># 0x0093: (&#39;SaturationAdjustment&#39;, ),</span>
    <span class="mh">0x0094</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;Saturation&#39;</span><span class="p">,</span>	<span class="c"># Name conflict with 0x00AA !!</span>
             <span class="p">{</span><span class="o">-</span><span class="mi">3</span><span class="p">:</span> <span class="s">&#39;B&amp;W&#39;</span><span class="p">,</span>
              <span class="o">-</span><span class="mi">2</span><span class="p">:</span> <span class="s">&#39;-2&#39;</span><span class="p">,</span>
              <span class="o">-</span><span class="mi">1</span><span class="p">:</span> <span class="s">&#39;-1&#39;</span><span class="p">,</span>
              <span class="mi">0</span><span class="p">:</span> <span class="s">&#39;0&#39;</span><span class="p">,</span>
              <span class="mi">1</span><span class="p">:</span> <span class="s">&#39;1&#39;</span><span class="p">,</span>
              <span class="mi">2</span><span class="p">:</span> <span class="s">&#39;2&#39;</span><span class="p">}),</span>
    <span class="mh">0x0095</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;NoiseReduction&#39;</span><span class="p">,</span> <span class="p">),</span>
    <span class="mh">0x0096</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;NEFCurve2&#39;</span><span class="p">,</span> <span class="p">),</span>
    <span class="mh">0x0097</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;ColorBalance&#39;</span><span class="p">,</span> <span class="p">),</span>
    <span class="mh">0x0098</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;LensData&#39;</span><span class="p">,</span> <span class="p">),</span>	<span class="c"># First 4 bytes are a version number in ASCII</span>
    <span class="mh">0x0099</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;RawImageCenter&#39;</span><span class="p">,</span> <span class="p">),</span>
    <span class="mh">0x009A</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;SensorPixelSize&#39;</span><span class="p">,</span> <span class="p">),</span>
    <span class="mh">0x009C</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;Scene Assist&#39;</span><span class="p">,</span> <span class="p">),</span>
    <span class="mh">0x00A0</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;SerialNumber&#39;</span><span class="p">,</span> <span class="p">),</span>
    <span class="mh">0x00A2</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;ImageDataSize&#39;</span><span class="p">,</span> <span class="p">),</span>
    <span class="c"># A4: In NEF, looks like a 4 byte ASCII version number</span>
    <span class="mh">0x00A5</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;ImageCount&#39;</span><span class="p">,</span> <span class="p">),</span>
    <span class="mh">0x00A6</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;DeletedImageCount&#39;</span><span class="p">,</span> <span class="p">),</span>
    <span class="mh">0x00A7</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;TotalShutterReleases&#39;</span><span class="p">,</span> <span class="p">),</span>
    <span class="c"># A8: ExposureMode?  JPG: First 4 bytes are probably a version number in ASCII</span>
    <span class="c"># But in a sample NEF, its 8 zeros, then the string &quot;NORMAL&quot;</span>
    <span class="mh">0x00A9</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;ImageOptimization&#39;</span><span class="p">,</span> <span class="p">),</span>
    <span class="mh">0x00AA</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;Saturation&#39;</span><span class="p">,</span> <span class="p">),</span>
    <span class="mh">0x00AB</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;DigitalVariProgram&#39;</span><span class="p">,</span> <span class="p">),</span>
    <span class="mh">0x00AC</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;ImageStabilization&#39;</span><span class="p">,</span> <span class="p">),</span>
    <span class="mh">0x00AD</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;Responsive AF&#39;</span><span class="p">,</span> <span class="p">),</span>	<span class="c"># &#39;AFResponse&#39;</span>
    <span class="mh">0x0010</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;DataDump&#39;</span><span class="p">,</span> <span class="p">),</span>
    <span class="p">}</span>

<span class="n">MAKERNOTE_NIKON_OLDER_TAGS</span> <span class="o">=</span> <span class="p">{</span>
    <span class="mh">0x0003</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;Quality&#39;</span><span class="p">,</span>
             <span class="p">{</span><span class="mi">1</span><span class="p">:</span> <span class="s">&#39;VGA Basic&#39;</span><span class="p">,</span>
              <span class="mi">2</span><span class="p">:</span> <span class="s">&#39;VGA Normal&#39;</span><span class="p">,</span>
              <span class="mi">3</span><span class="p">:</span> <span class="s">&#39;VGA Fine&#39;</span><span class="p">,</span>
              <span class="mi">4</span><span class="p">:</span> <span class="s">&#39;SXGA Basic&#39;</span><span class="p">,</span>
              <span class="mi">5</span><span class="p">:</span> <span class="s">&#39;SXGA Normal&#39;</span><span class="p">,</span>
              <span class="mi">6</span><span class="p">:</span> <span class="s">&#39;SXGA Fine&#39;</span><span class="p">}),</span>
    <span class="mh">0x0004</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;ColorMode&#39;</span><span class="p">,</span>
             <span class="p">{</span><span class="mi">1</span><span class="p">:</span> <span class="s">&#39;Color&#39;</span><span class="p">,</span>
              <span class="mi">2</span><span class="p">:</span> <span class="s">&#39;Monochrome&#39;</span><span class="p">}),</span>
    <span class="mh">0x0005</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;ImageAdjustment&#39;</span><span class="p">,</span>
             <span class="p">{</span><span class="mi">0</span><span class="p">:</span> <span class="s">&#39;Normal&#39;</span><span class="p">,</span>
              <span class="mi">1</span><span class="p">:</span> <span class="s">&#39;Bright+&#39;</span><span class="p">,</span>
              <span class="mi">2</span><span class="p">:</span> <span class="s">&#39;Bright-&#39;</span><span class="p">,</span>
              <span class="mi">3</span><span class="p">:</span> <span class="s">&#39;Contrast+&#39;</span><span class="p">,</span>
              <span class="mi">4</span><span class="p">:</span> <span class="s">&#39;Contrast-&#39;</span><span class="p">}),</span>
    <span class="mh">0x0006</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;CCDSpeed&#39;</span><span class="p">,</span>
             <span class="p">{</span><span class="mi">0</span><span class="p">:</span> <span class="s">&#39;ISO 80&#39;</span><span class="p">,</span>
              <span class="mi">2</span><span class="p">:</span> <span class="s">&#39;ISO 160&#39;</span><span class="p">,</span>
              <span class="mi">4</span><span class="p">:</span> <span class="s">&#39;ISO 320&#39;</span><span class="p">,</span>
              <span class="mi">5</span><span class="p">:</span> <span class="s">&#39;ISO 100&#39;</span><span class="p">}),</span>
    <span class="mh">0x0007</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;WhiteBalance&#39;</span><span class="p">,</span>
             <span class="p">{</span><span class="mi">0</span><span class="p">:</span> <span class="s">&#39;Auto&#39;</span><span class="p">,</span>
              <span class="mi">1</span><span class="p">:</span> <span class="s">&#39;Preset&#39;</span><span class="p">,</span>
              <span class="mi">2</span><span class="p">:</span> <span class="s">&#39;Daylight&#39;</span><span class="p">,</span>
              <span class="mi">3</span><span class="p">:</span> <span class="s">&#39;Incandescent&#39;</span><span class="p">,</span>
              <span class="mi">4</span><span class="p">:</span> <span class="s">&#39;Fluorescent&#39;</span><span class="p">,</span>
              <span class="mi">5</span><span class="p">:</span> <span class="s">&#39;Cloudy&#39;</span><span class="p">,</span>
              <span class="mi">6</span><span class="p">:</span> <span class="s">&#39;Speed Light&#39;</span><span class="p">}),</span>
    <span class="p">}</span>

<span class="c"># decode Olympus SpecialMode tag in MakerNote</span>
<div class="viewcode-block" id="olympus_special_mode"><a class="viewcode-back" href="../../../../pytomo.kaa_metadata.image.html#pytomo.kaa_metadata.image.EXIF.olympus_special_mode">[docs]</a><span class="k">def</span> <span class="nf">olympus_special_mode</span><span class="p">(</span><span class="n">v</span><span class="p">):</span>
    <span class="n">a</span><span class="o">=</span><span class="p">{</span>
        <span class="mi">0</span><span class="p">:</span> <span class="s">&#39;Normal&#39;</span><span class="p">,</span>
        <span class="mi">1</span><span class="p">:</span> <span class="s">&#39;Unknown&#39;</span><span class="p">,</span>
        <span class="mi">2</span><span class="p">:</span> <span class="s">&#39;Fast&#39;</span><span class="p">,</span>
        <span class="mi">3</span><span class="p">:</span> <span class="s">&#39;Panorama&#39;</span><span class="p">}</span>
    <span class="n">b</span><span class="o">=</span><span class="p">{</span>
        <span class="mi">0</span><span class="p">:</span> <span class="s">&#39;Non-panoramic&#39;</span><span class="p">,</span>
        <span class="mi">1</span><span class="p">:</span> <span class="s">&#39;Left to right&#39;</span><span class="p">,</span>
        <span class="mi">2</span><span class="p">:</span> <span class="s">&#39;Right to left&#39;</span><span class="p">,</span>
        <span class="mi">3</span><span class="p">:</span> <span class="s">&#39;Bottom to top&#39;</span><span class="p">,</span>
        <span class="mi">4</span><span class="p">:</span> <span class="s">&#39;Top to bottom&#39;</span><span class="p">}</span>
    <span class="k">if</span> <span class="n">v</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">a</span> <span class="ow">or</span> <span class="n">v</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">b</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">v</span>
    <span class="k">return</span> <span class="s">&#39;</span><span class="si">%s</span><span class="s"> - sequence </span><span class="si">%d</span><span class="s"> - </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">a</span><span class="p">[</span><span class="n">v</span><span class="p">[</span><span class="mi">0</span><span class="p">]],</span> <span class="n">v</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">b</span><span class="p">[</span><span class="n">v</span><span class="p">[</span><span class="mi">2</span><span class="p">]])</span>
</div>
<span class="n">MAKERNOTE_OLYMPUS_TAGS</span><span class="o">=</span><span class="p">{</span>
    <span class="c"># ah HAH! those sneeeeeaky bastids! this is how they get past the fact</span>
    <span class="c"># that a JPEG thumbnail is not allowed in an uncompressed TIFF file</span>
    <span class="mh">0x0100</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;JPEGThumbnail&#39;</span><span class="p">,</span> <span class="p">),</span>
    <span class="mh">0x0200</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;SpecialMode&#39;</span><span class="p">,</span> <span class="n">olympus_special_mode</span><span class="p">),</span>
    <span class="mh">0x0201</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;JPEGQual&#39;</span><span class="p">,</span>
             <span class="p">{</span><span class="mi">1</span><span class="p">:</span> <span class="s">&#39;SQ&#39;</span><span class="p">,</span>
              <span class="mi">2</span><span class="p">:</span> <span class="s">&#39;HQ&#39;</span><span class="p">,</span>
              <span class="mi">3</span><span class="p">:</span> <span class="s">&#39;SHQ&#39;</span><span class="p">}),</span>
    <span class="mh">0x0202</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;Macro&#39;</span><span class="p">,</span>
             <span class="p">{</span><span class="mi">0</span><span class="p">:</span> <span class="s">&#39;Normal&#39;</span><span class="p">,</span>
             <span class="mi">1</span><span class="p">:</span> <span class="s">&#39;Macro&#39;</span><span class="p">,</span>
             <span class="mi">2</span><span class="p">:</span> <span class="s">&#39;SuperMacro&#39;</span><span class="p">}),</span>
    <span class="mh">0x0203</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;BWMode&#39;</span><span class="p">,</span>
             <span class="p">{</span><span class="mi">0</span><span class="p">:</span> <span class="s">&#39;Off&#39;</span><span class="p">,</span>
             <span class="mi">1</span><span class="p">:</span> <span class="s">&#39;On&#39;</span><span class="p">}),</span>
    <span class="mh">0x0204</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;DigitalZoom&#39;</span><span class="p">,</span> <span class="p">),</span>
    <span class="mh">0x0205</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;FocalPlaneDiagonal&#39;</span><span class="p">,</span> <span class="p">),</span>
    <span class="mh">0x0206</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;LensDistortionParams&#39;</span><span class="p">,</span> <span class="p">),</span>
    <span class="mh">0x0207</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;SoftwareRelease&#39;</span><span class="p">,</span> <span class="p">),</span>
    <span class="mh">0x0208</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;PictureInfo&#39;</span><span class="p">,</span> <span class="p">),</span>
    <span class="mh">0x0209</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;CameraID&#39;</span><span class="p">,</span> <span class="n">make_string</span><span class="p">),</span> <span class="c"># print as string</span>
    <span class="mh">0x0F00</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;DataDump&#39;</span><span class="p">,</span> <span class="p">),</span>
    <span class="mh">0x0300</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;PreCaptureFrames&#39;</span><span class="p">,</span> <span class="p">),</span>
    <span class="mh">0x0404</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;SerialNumber&#39;</span><span class="p">,</span> <span class="p">),</span>
    <span class="mh">0x1000</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;ShutterSpeedValue&#39;</span><span class="p">,</span> <span class="p">),</span>
    <span class="mh">0x1001</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;ISOValue&#39;</span><span class="p">,</span> <span class="p">),</span>
    <span class="mh">0x1002</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;ApertureValue&#39;</span><span class="p">,</span> <span class="p">),</span>
    <span class="mh">0x1003</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;BrightnessValue&#39;</span><span class="p">,</span> <span class="p">),</span>
    <span class="mh">0x1004</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;FlashMode&#39;</span><span class="p">,</span> <span class="p">),</span>
    <span class="mh">0x1004</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;FlashMode&#39;</span><span class="p">,</span>
       <span class="p">{</span><span class="mi">2</span><span class="p">:</span> <span class="s">&#39;On&#39;</span><span class="p">,</span>
        <span class="mi">3</span><span class="p">:</span> <span class="s">&#39;Off&#39;</span><span class="p">}),</span>
    <span class="mh">0x1005</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;FlashDevice&#39;</span><span class="p">,</span>
       <span class="p">{</span><span class="mi">0</span><span class="p">:</span> <span class="s">&#39;None&#39;</span><span class="p">,</span>
        <span class="mi">1</span><span class="p">:</span> <span class="s">&#39;Internal&#39;</span><span class="p">,</span>
        <span class="mi">4</span><span class="p">:</span> <span class="s">&#39;External&#39;</span><span class="p">,</span>
        <span class="mi">5</span><span class="p">:</span> <span class="s">&#39;Internal + External&#39;</span><span class="p">}),</span>
    <span class="mh">0x1006</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;ExposureCompensation&#39;</span><span class="p">,</span> <span class="p">),</span>
    <span class="mh">0x1007</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;SensorTemperature&#39;</span><span class="p">,</span> <span class="p">),</span>
    <span class="mh">0x1008</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;LensTemperature&#39;</span><span class="p">,</span> <span class="p">),</span>
    <span class="mh">0x100b</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;FocusMode&#39;</span><span class="p">,</span>
       <span class="p">{</span><span class="mi">0</span><span class="p">:</span> <span class="s">&#39;Auto&#39;</span><span class="p">,</span>
        <span class="mi">1</span><span class="p">:</span> <span class="s">&#39;Manual&#39;</span><span class="p">}),</span>
    <span class="mh">0x1017</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;RedBalance&#39;</span><span class="p">,</span> <span class="p">),</span>
    <span class="mh">0x1018</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;BlueBalance&#39;</span><span class="p">,</span> <span class="p">),</span>
    <span class="mh">0x101a</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;SerialNumber&#39;</span><span class="p">,</span> <span class="p">),</span>
    <span class="mh">0x1023</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;FlashExposureComp&#39;</span><span class="p">,</span> <span class="p">),</span>
    <span class="mh">0x1026</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;ExternalFlashBounce&#39;</span><span class="p">,</span>
       <span class="p">{</span><span class="mi">0</span><span class="p">:</span> <span class="s">&#39;No&#39;</span><span class="p">,</span>
        <span class="mi">1</span><span class="p">:</span> <span class="s">&#39;Yes&#39;</span><span class="p">}),</span>
    <span class="mh">0x1027</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;ExternalFlashZoom&#39;</span><span class="p">,</span> <span class="p">),</span>
    <span class="mh">0x1028</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;ExternalFlashMode&#39;</span><span class="p">,</span> <span class="p">),</span>
    <span class="mh">0x1029</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;Contrast 	int16u&#39;</span><span class="p">,</span>
       <span class="p">{</span><span class="mi">0</span><span class="p">:</span> <span class="s">&#39;High&#39;</span><span class="p">,</span>
        <span class="mi">1</span><span class="p">:</span> <span class="s">&#39;Normal&#39;</span><span class="p">,</span>
        <span class="mi">2</span><span class="p">:</span> <span class="s">&#39;Low&#39;</span><span class="p">}),</span>
    <span class="mh">0x102a</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;SharpnessFactor&#39;</span><span class="p">,</span> <span class="p">),</span>
    <span class="mh">0x102b</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;ColorControl&#39;</span><span class="p">,</span> <span class="p">),</span>
    <span class="mh">0x102c</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;ValidBits&#39;</span><span class="p">,</span> <span class="p">),</span>
    <span class="mh">0x102d</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;CoringFilter&#39;</span><span class="p">,</span> <span class="p">),</span>
    <span class="mh">0x102e</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;OlympusImageWidth&#39;</span><span class="p">,</span> <span class="p">),</span>
    <span class="mh">0x102f</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;OlympusImageHeight&#39;</span><span class="p">,</span> <span class="p">),</span>
    <span class="mh">0x1034</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;CompressionRatio&#39;</span><span class="p">,</span> <span class="p">),</span>
    <span class="mh">0x1035</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;PreviewImageValid&#39;</span><span class="p">,</span>
       <span class="p">{</span><span class="mi">0</span><span class="p">:</span> <span class="s">&#39;No&#39;</span><span class="p">,</span>
        <span class="mi">1</span><span class="p">:</span> <span class="s">&#39;Yes&#39;</span><span class="p">}),</span>
    <span class="mh">0x1036</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;PreviewImageStart&#39;</span><span class="p">,</span> <span class="p">),</span>
    <span class="mh">0x1037</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;PreviewImageLength&#39;</span><span class="p">,</span> <span class="p">),</span>
    <span class="mh">0x1039</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;CCDScanMode&#39;</span><span class="p">,</span>
       <span class="p">{</span><span class="mi">0</span><span class="p">:</span> <span class="s">&#39;Interlaced&#39;</span><span class="p">,</span>
        <span class="mi">1</span><span class="p">:</span> <span class="s">&#39;Progressive&#39;</span><span class="p">}),</span>
    <span class="mh">0x103a</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;NoiseReduction&#39;</span><span class="p">,</span>
       <span class="p">{</span><span class="mi">0</span><span class="p">:</span> <span class="s">&#39;Off&#39;</span><span class="p">,</span>
        <span class="mi">1</span><span class="p">:</span> <span class="s">&#39;On&#39;</span><span class="p">}),</span>
    <span class="mh">0x103b</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;InfinityLensStep&#39;</span><span class="p">,</span> <span class="p">),</span>
    <span class="mh">0x103c</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;NearLensStep&#39;</span><span class="p">,</span> <span class="p">),</span>

    <span class="c"># TODO - these need extra definitions</span>
    <span class="c"># http://search.cpan.org/src/EXIFTOOL/Image-ExifTool-6.90/html/TagNames/Olympus.html</span>
    <span class="mh">0x2010</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;Equipment&#39;</span><span class="p">,</span> <span class="p">),</span>
    <span class="mh">0x2020</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;CameraSettings&#39;</span><span class="p">,</span> <span class="p">),</span>
    <span class="mh">0x2030</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;RawDevelopment&#39;</span><span class="p">,</span> <span class="p">),</span>
    <span class="mh">0x2040</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;ImageProcessing&#39;</span><span class="p">,</span> <span class="p">),</span>
    <span class="mh">0x2050</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;FocusInfo&#39;</span><span class="p">,</span> <span class="p">),</span>
    <span class="mh">0x3000</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;RawInfo &#39;</span><span class="p">,</span> <span class="p">),</span>
    <span class="p">}</span>

<span class="c"># 0x2020 CameraSettings</span>
<span class="n">MAKERNOTE_OLYMPUS_TAG_0x2020</span><span class="o">=</span><span class="p">{</span>
    <span class="mh">0x0100</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;PreviewImageValid&#39;</span><span class="p">,</span>
        <span class="p">{</span><span class="mi">0</span><span class="p">:</span> <span class="s">&#39;No&#39;</span><span class="p">,</span>
         <span class="mi">1</span><span class="p">:</span> <span class="s">&#39;Yes&#39;</span><span class="p">}),</span>
    <span class="mh">0x0101</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;PreviewImageStart&#39;</span><span class="p">,</span> <span class="p">),</span>
    <span class="mh">0x0102</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;PreviewImageLength&#39;</span><span class="p">,</span> <span class="p">),</span>
    <span class="mh">0x0200</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;ExposureMode&#39;</span><span class="p">,</span> <span class="p">{</span>
        <span class="mi">1</span><span class="p">:</span> <span class="s">&#39;Manual&#39;</span><span class="p">,</span>
        <span class="mi">2</span><span class="p">:</span> <span class="s">&#39;Program&#39;</span><span class="p">,</span>
        <span class="mi">3</span><span class="p">:</span> <span class="s">&#39;Aperture-priority AE&#39;</span><span class="p">,</span>
        <span class="mi">4</span><span class="p">:</span> <span class="s">&#39;Shutter speed priority AE&#39;</span><span class="p">,</span>
        <span class="mi">5</span><span class="p">:</span> <span class="s">&#39;Program-shift&#39;</span><span class="p">}),</span>
    <span class="mh">0x0201</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;AELock&#39;</span><span class="p">,</span>
       <span class="p">{</span><span class="mi">0</span><span class="p">:</span> <span class="s">&#39;Off&#39;</span><span class="p">,</span>
        <span class="mi">1</span><span class="p">:</span> <span class="s">&#39;On&#39;</span><span class="p">}),</span>
    <span class="mh">0x0202</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;MeteringMode&#39;</span><span class="p">,</span>
       <span class="p">{</span><span class="mi">2</span><span class="p">:</span> <span class="s">&#39;Center Weighted&#39;</span><span class="p">,</span>
        <span class="mi">3</span><span class="p">:</span> <span class="s">&#39;Spot&#39;</span><span class="p">,</span>
        <span class="mi">5</span><span class="p">:</span> <span class="s">&#39;ESP&#39;</span><span class="p">,</span>
        <span class="mi">261</span><span class="p">:</span> <span class="s">&#39;Pattern+AF&#39;</span><span class="p">,</span>
        <span class="mi">515</span><span class="p">:</span> <span class="s">&#39;Spot+Highlight control&#39;</span><span class="p">,</span>
        <span class="mi">1027</span><span class="p">:</span> <span class="s">&#39;Spot+Shadow control&#39;</span><span class="p">}),</span>
    <span class="mh">0x0300</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;MacroMode&#39;</span><span class="p">,</span>
       <span class="p">{</span><span class="mi">0</span><span class="p">:</span> <span class="s">&#39;Off&#39;</span><span class="p">,</span>
        <span class="mi">1</span><span class="p">:</span> <span class="s">&#39;On&#39;</span><span class="p">}),</span>
    <span class="mh">0x0301</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;FocusMode&#39;</span><span class="p">,</span>
       <span class="p">{</span><span class="mi">0</span><span class="p">:</span> <span class="s">&#39;Single AF&#39;</span><span class="p">,</span>
        <span class="mi">1</span><span class="p">:</span> <span class="s">&#39;Sequential shooting AF&#39;</span><span class="p">,</span>
        <span class="mi">2</span><span class="p">:</span> <span class="s">&#39;Continuous AF&#39;</span><span class="p">,</span>
        <span class="mi">3</span><span class="p">:</span> <span class="s">&#39;Multi AF&#39;</span><span class="p">,</span>
        <span class="mi">10</span><span class="p">:</span> <span class="s">&#39;MF&#39;</span><span class="p">}),</span>
    <span class="mh">0x0302</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;FocusProcess&#39;</span><span class="p">,</span>
       <span class="p">{</span><span class="mi">0</span><span class="p">:</span> <span class="s">&#39;AF Not Used&#39;</span><span class="p">,</span>
        <span class="mi">1</span><span class="p">:</span> <span class="s">&#39;AF Used&#39;</span><span class="p">}),</span>
    <span class="mh">0x0303</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;AFSearch&#39;</span><span class="p">,</span>
       <span class="p">{</span><span class="mi">0</span><span class="p">:</span> <span class="s">&#39;Not Ready&#39;</span><span class="p">,</span>
        <span class="mi">1</span><span class="p">:</span> <span class="s">&#39;Ready&#39;</span><span class="p">}),</span>
    <span class="mh">0x0304</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;AFAreas&#39;</span><span class="p">,</span> <span class="p">),</span>
    <span class="mh">0x0401</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;FlashExposureCompensation&#39;</span><span class="p">,</span> <span class="p">),</span>
    <span class="mh">0x0500</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;WhiteBalance2&#39;</span><span class="p">,</span>
       <span class="p">{</span><span class="mi">0</span><span class="p">:</span> <span class="s">&#39;Auto&#39;</span><span class="p">,</span>
        <span class="mi">16</span><span class="p">:</span> <span class="s">&#39;7500K (Fine Weather with Shade)&#39;</span><span class="p">,</span>
        <span class="mi">17</span><span class="p">:</span> <span class="s">&#39;6000K (Cloudy)&#39;</span><span class="p">,</span>
        <span class="mi">18</span><span class="p">:</span> <span class="s">&#39;5300K (Fine Weather)&#39;</span><span class="p">,</span>
        <span class="mi">20</span><span class="p">:</span> <span class="s">&#39;3000K (Tungsten light)&#39;</span><span class="p">,</span>
        <span class="mi">21</span><span class="p">:</span> <span class="s">&#39;3600K (Tungsten light-like)&#39;</span><span class="p">,</span>
        <span class="mi">33</span><span class="p">:</span> <span class="s">&#39;6600K (Daylight fluorescent)&#39;</span><span class="p">,</span>
        <span class="mi">34</span><span class="p">:</span> <span class="s">&#39;4500K (Neutral white fluorescent)&#39;</span><span class="p">,</span>
        <span class="mi">35</span><span class="p">:</span> <span class="s">&#39;4000K (Cool white fluorescent)&#39;</span><span class="p">,</span>
        <span class="mi">48</span><span class="p">:</span> <span class="s">&#39;3600K (Tungsten light-like)&#39;</span><span class="p">,</span>
        <span class="mi">256</span><span class="p">:</span> <span class="s">&#39;Custom WB 1&#39;</span><span class="p">,</span>
        <span class="mi">257</span><span class="p">:</span> <span class="s">&#39;Custom WB 2&#39;</span><span class="p">,</span>
        <span class="mi">258</span><span class="p">:</span> <span class="s">&#39;Custom WB 3&#39;</span><span class="p">,</span>
        <span class="mi">259</span><span class="p">:</span> <span class="s">&#39;Custom WB 4&#39;</span><span class="p">,</span>
        <span class="mi">512</span><span class="p">:</span> <span class="s">&#39;Custom WB 5400K&#39;</span><span class="p">,</span>
        <span class="mi">513</span><span class="p">:</span> <span class="s">&#39;Custom WB 2900K&#39;</span><span class="p">,</span>
        <span class="mi">514</span><span class="p">:</span> <span class="s">&#39;Custom WB 8000K&#39;</span><span class="p">,</span> <span class="p">}),</span>
    <span class="mh">0x0501</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;WhiteBalanceTemperature&#39;</span><span class="p">,</span> <span class="p">),</span>
    <span class="mh">0x0502</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;WhiteBalanceBracket&#39;</span><span class="p">,</span> <span class="p">),</span>
    <span class="mh">0x0503</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;CustomSaturation&#39;</span><span class="p">,</span> <span class="p">),</span> <span class="c"># (3 numbers: 1. CS Value, 2. Min, 3. Max)</span>
    <span class="mh">0x0504</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;ModifiedSaturation&#39;</span><span class="p">,</span>
       <span class="p">{</span><span class="mi">0</span><span class="p">:</span> <span class="s">&#39;Off&#39;</span><span class="p">,</span>
        <span class="mi">1</span><span class="p">:</span> <span class="s">&#39;CM1 (Red Enhance)&#39;</span><span class="p">,</span>
        <span class="mi">2</span><span class="p">:</span> <span class="s">&#39;CM2 (Green Enhance)&#39;</span><span class="p">,</span>
        <span class="mi">3</span><span class="p">:</span> <span class="s">&#39;CM3 (Blue Enhance)&#39;</span><span class="p">,</span>
        <span class="mi">4</span><span class="p">:</span> <span class="s">&#39;CM4 (Skin Tones)&#39;</span><span class="p">}),</span>
    <span class="mh">0x0505</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;ContrastSetting&#39;</span><span class="p">,</span> <span class="p">),</span> <span class="c"># (3 numbers: 1. Contrast, 2. Min, 3. Max)</span>
    <span class="mh">0x0506</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;SharpnessSetting&#39;</span><span class="p">,</span> <span class="p">),</span> <span class="c"># (3 numbers: 1. Sharpness, 2. Min, 3. Max)</span>
    <span class="mh">0x0507</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;ColorSpace&#39;</span><span class="p">,</span>
       <span class="p">{</span><span class="mi">0</span><span class="p">:</span> <span class="s">&#39;sRGB&#39;</span><span class="p">,</span>
        <span class="mi">1</span><span class="p">:</span> <span class="s">&#39;Adobe RGB&#39;</span><span class="p">,</span>
        <span class="mi">2</span><span class="p">:</span> <span class="s">&#39;Pro Photo RGB&#39;</span><span class="p">}),</span>
    <span class="mh">0x0509</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;SceneMode&#39;</span><span class="p">,</span>
       <span class="p">{</span><span class="mi">0</span><span class="p">:</span> <span class="s">&#39;Standard&#39;</span><span class="p">,</span>
        <span class="mi">6</span><span class="p">:</span> <span class="s">&#39;Auto&#39;</span><span class="p">,</span>
        <span class="mi">7</span><span class="p">:</span> <span class="s">&#39;Sport&#39;</span><span class="p">,</span>
        <span class="mi">8</span><span class="p">:</span> <span class="s">&#39;Portrait&#39;</span><span class="p">,</span>
        <span class="mi">9</span><span class="p">:</span> <span class="s">&#39;Landscape+Portrait&#39;</span><span class="p">,</span>
        <span class="mi">10</span><span class="p">:</span> <span class="s">&#39;Landscape&#39;</span><span class="p">,</span>
        <span class="mi">11</span><span class="p">:</span> <span class="s">&#39;Night scene&#39;</span><span class="p">,</span>
        <span class="mi">13</span><span class="p">:</span> <span class="s">&#39;Panorama&#39;</span><span class="p">,</span>
        <span class="mi">16</span><span class="p">:</span> <span class="s">&#39;Landscape+Portrait&#39;</span><span class="p">,</span>
        <span class="mi">17</span><span class="p">:</span> <span class="s">&#39;Night+Portrait&#39;</span><span class="p">,</span>
        <span class="mi">19</span><span class="p">:</span> <span class="s">&#39;Fireworks&#39;</span><span class="p">,</span>
        <span class="mi">20</span><span class="p">:</span> <span class="s">&#39;Sunset&#39;</span><span class="p">,</span>
        <span class="mi">22</span><span class="p">:</span> <span class="s">&#39;Macro&#39;</span><span class="p">,</span>
        <span class="mi">25</span><span class="p">:</span> <span class="s">&#39;Documents&#39;</span><span class="p">,</span>
        <span class="mi">26</span><span class="p">:</span> <span class="s">&#39;Museum&#39;</span><span class="p">,</span>
        <span class="mi">28</span><span class="p">:</span> <span class="s">&#39;Beach&amp;Snow&#39;</span><span class="p">,</span>
        <span class="mi">30</span><span class="p">:</span> <span class="s">&#39;Candle&#39;</span><span class="p">,</span>
        <span class="mi">35</span><span class="p">:</span> <span class="s">&#39;Underwater Wide1&#39;</span><span class="p">,</span>
        <span class="mi">36</span><span class="p">:</span> <span class="s">&#39;Underwater Macro&#39;</span><span class="p">,</span>
        <span class="mi">39</span><span class="p">:</span> <span class="s">&#39;High Key&#39;</span><span class="p">,</span>
        <span class="mi">40</span><span class="p">:</span> <span class="s">&#39;Digital Image Stabilization&#39;</span><span class="p">,</span>
        <span class="mi">44</span><span class="p">:</span> <span class="s">&#39;Underwater Wide2&#39;</span><span class="p">,</span>
        <span class="mi">45</span><span class="p">:</span> <span class="s">&#39;Low Key&#39;</span><span class="p">,</span>
        <span class="mi">46</span><span class="p">:</span> <span class="s">&#39;Children&#39;</span><span class="p">,</span>
        <span class="mi">48</span><span class="p">:</span> <span class="s">&#39;Nature Macro&#39;</span><span class="p">}),</span>
    <span class="mh">0x050a</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;NoiseReduction&#39;</span><span class="p">,</span>
       <span class="p">{</span><span class="mi">0</span><span class="p">:</span> <span class="s">&#39;Off&#39;</span><span class="p">,</span>
        <span class="mi">1</span><span class="p">:</span> <span class="s">&#39;Noise Reduction&#39;</span><span class="p">,</span>
        <span class="mi">2</span><span class="p">:</span> <span class="s">&#39;Noise Filter&#39;</span><span class="p">,</span>
        <span class="mi">3</span><span class="p">:</span> <span class="s">&#39;Noise Reduction + Noise Filter&#39;</span><span class="p">,</span>
        <span class="mi">4</span><span class="p">:</span> <span class="s">&#39;Noise Filter (ISO Boost)&#39;</span><span class="p">,</span>
        <span class="mi">5</span><span class="p">:</span> <span class="s">&#39;Noise Reduction + Noise Filter (ISO Boost)&#39;</span><span class="p">}),</span>
    <span class="mh">0x050b</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;DistortionCorrection&#39;</span><span class="p">,</span>
       <span class="p">{</span><span class="mi">0</span><span class="p">:</span> <span class="s">&#39;Off&#39;</span><span class="p">,</span>
        <span class="mi">1</span><span class="p">:</span> <span class="s">&#39;On&#39;</span><span class="p">}),</span>
    <span class="mh">0x050c</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;ShadingCompensation&#39;</span><span class="p">,</span>
       <span class="p">{</span><span class="mi">0</span><span class="p">:</span> <span class="s">&#39;Off&#39;</span><span class="p">,</span>
        <span class="mi">1</span><span class="p">:</span> <span class="s">&#39;On&#39;</span><span class="p">}),</span>
    <span class="mh">0x050d</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;CompressionFactor&#39;</span><span class="p">,</span> <span class="p">),</span>
    <span class="mh">0x050f</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;Gradation&#39;</span><span class="p">,</span>
       <span class="p">{</span><span class="s">&#39;-1 -1 1&#39;</span><span class="p">:</span> <span class="s">&#39;Low Key&#39;</span><span class="p">,</span>
        <span class="s">&#39;0 -1 1&#39;</span><span class="p">:</span> <span class="s">&#39;Normal&#39;</span><span class="p">,</span>
        <span class="s">&#39;1 -1 1&#39;</span><span class="p">:</span> <span class="s">&#39;High Key&#39;</span><span class="p">}),</span>
    <span class="mh">0x0520</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;PictureMode&#39;</span><span class="p">,</span>
       <span class="p">{</span><span class="mi">1</span><span class="p">:</span> <span class="s">&#39;Vivid&#39;</span><span class="p">,</span>
        <span class="mi">2</span><span class="p">:</span> <span class="s">&#39;Natural&#39;</span><span class="p">,</span>
        <span class="mi">3</span><span class="p">:</span> <span class="s">&#39;Muted&#39;</span><span class="p">,</span>
        <span class="mi">256</span><span class="p">:</span> <span class="s">&#39;Monotone&#39;</span><span class="p">,</span>
        <span class="mi">512</span><span class="p">:</span> <span class="s">&#39;Sepia&#39;</span><span class="p">}),</span>
    <span class="mh">0x0521</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;PictureModeSaturation&#39;</span><span class="p">,</span> <span class="p">),</span>
    <span class="mh">0x0522</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;PictureModeHue?&#39;</span><span class="p">,</span> <span class="p">),</span>
    <span class="mh">0x0523</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;PictureModeContrast&#39;</span><span class="p">,</span> <span class="p">),</span>
    <span class="mh">0x0524</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;PictureModeSharpness&#39;</span><span class="p">,</span> <span class="p">),</span>
    <span class="mh">0x0525</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;PictureModeBWFilter&#39;</span><span class="p">,</span>
       <span class="p">{</span><span class="mi">0</span><span class="p">:</span> <span class="s">&#39;n/a&#39;</span><span class="p">,</span>
        <span class="mi">1</span><span class="p">:</span> <span class="s">&#39;Neutral&#39;</span><span class="p">,</span>
        <span class="mi">2</span><span class="p">:</span> <span class="s">&#39;Yellow&#39;</span><span class="p">,</span>
        <span class="mi">3</span><span class="p">:</span> <span class="s">&#39;Orange&#39;</span><span class="p">,</span>
        <span class="mi">4</span><span class="p">:</span> <span class="s">&#39;Red&#39;</span><span class="p">,</span>
        <span class="mi">5</span><span class="p">:</span> <span class="s">&#39;Green&#39;</span><span class="p">}),</span>
    <span class="mh">0x0526</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;PictureModeTone&#39;</span><span class="p">,</span>
       <span class="p">{</span><span class="mi">0</span><span class="p">:</span> <span class="s">&#39;n/a&#39;</span><span class="p">,</span>
        <span class="mi">1</span><span class="p">:</span> <span class="s">&#39;Neutral&#39;</span><span class="p">,</span>
        <span class="mi">2</span><span class="p">:</span> <span class="s">&#39;Sepia&#39;</span><span class="p">,</span>
        <span class="mi">3</span><span class="p">:</span> <span class="s">&#39;Blue&#39;</span><span class="p">,</span>
        <span class="mi">4</span><span class="p">:</span> <span class="s">&#39;Purple&#39;</span><span class="p">,</span>
        <span class="mi">5</span><span class="p">:</span> <span class="s">&#39;Green&#39;</span><span class="p">}),</span>
    <span class="mh">0x0600</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;Sequence&#39;</span><span class="p">,</span> <span class="p">),</span> <span class="c"># 2 or 3 numbers: 1. Mode, 2. Shot number, 3. Mode bits</span>
    <span class="mh">0x0601</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;PanoramaMode&#39;</span><span class="p">,</span> <span class="p">),</span> <span class="c"># (2 numbers: 1. Mode, 2. Shot number)</span>
    <span class="mh">0x0603</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;ImageQuality2&#39;</span><span class="p">,</span>
       <span class="p">{</span><span class="mi">1</span><span class="p">:</span> <span class="s">&#39;SQ&#39;</span><span class="p">,</span>
        <span class="mi">2</span><span class="p">:</span> <span class="s">&#39;HQ&#39;</span><span class="p">,</span>
        <span class="mi">3</span><span class="p">:</span> <span class="s">&#39;SHQ&#39;</span><span class="p">,</span>
        <span class="mi">4</span><span class="p">:</span> <span class="s">&#39;RAW&#39;</span><span class="p">}),</span>
    <span class="mh">0x0901</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;ManometerReading&#39;</span><span class="p">,</span> <span class="p">),</span>
    <span class="p">}</span>


<span class="n">MAKERNOTE_CASIO_TAGS</span><span class="o">=</span><span class="p">{</span>
    <span class="mh">0x0001</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;RecordingMode&#39;</span><span class="p">,</span>
             <span class="p">{</span><span class="mi">1</span><span class="p">:</span> <span class="s">&#39;Single Shutter&#39;</span><span class="p">,</span>
              <span class="mi">2</span><span class="p">:</span> <span class="s">&#39;Panorama&#39;</span><span class="p">,</span>
              <span class="mi">3</span><span class="p">:</span> <span class="s">&#39;Night Scene&#39;</span><span class="p">,</span>
              <span class="mi">4</span><span class="p">:</span> <span class="s">&#39;Portrait&#39;</span><span class="p">,</span>
              <span class="mi">5</span><span class="p">:</span> <span class="s">&#39;Landscape&#39;</span><span class="p">}),</span>
    <span class="mh">0x0002</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;Quality&#39;</span><span class="p">,</span>
             <span class="p">{</span><span class="mi">1</span><span class="p">:</span> <span class="s">&#39;Economy&#39;</span><span class="p">,</span>
              <span class="mi">2</span><span class="p">:</span> <span class="s">&#39;Normal&#39;</span><span class="p">,</span>
              <span class="mi">3</span><span class="p">:</span> <span class="s">&#39;Fine&#39;</span><span class="p">}),</span>
    <span class="mh">0x0003</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;FocusingMode&#39;</span><span class="p">,</span>
             <span class="p">{</span><span class="mi">2</span><span class="p">:</span> <span class="s">&#39;Macro&#39;</span><span class="p">,</span>
              <span class="mi">3</span><span class="p">:</span> <span class="s">&#39;Auto Focus&#39;</span><span class="p">,</span>
              <span class="mi">4</span><span class="p">:</span> <span class="s">&#39;Manual Focus&#39;</span><span class="p">,</span>
              <span class="mi">5</span><span class="p">:</span> <span class="s">&#39;Infinity&#39;</span><span class="p">}),</span>
    <span class="mh">0x0004</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;FlashMode&#39;</span><span class="p">,</span>
             <span class="p">{</span><span class="mi">1</span><span class="p">:</span> <span class="s">&#39;Auto&#39;</span><span class="p">,</span>
              <span class="mi">2</span><span class="p">:</span> <span class="s">&#39;On&#39;</span><span class="p">,</span>
              <span class="mi">3</span><span class="p">:</span> <span class="s">&#39;Off&#39;</span><span class="p">,</span>
              <span class="mi">4</span><span class="p">:</span> <span class="s">&#39;Red Eye Reduction&#39;</span><span class="p">}),</span>
    <span class="mh">0x0005</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;FlashIntensity&#39;</span><span class="p">,</span>
             <span class="p">{</span><span class="mi">11</span><span class="p">:</span> <span class="s">&#39;Weak&#39;</span><span class="p">,</span>
              <span class="mi">13</span><span class="p">:</span> <span class="s">&#39;Normal&#39;</span><span class="p">,</span>
              <span class="mi">15</span><span class="p">:</span> <span class="s">&#39;Strong&#39;</span><span class="p">}),</span>
    <span class="mh">0x0006</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;Object Distance&#39;</span><span class="p">,</span> <span class="p">),</span>
    <span class="mh">0x0007</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;WhiteBalance&#39;</span><span class="p">,</span>
             <span class="p">{</span><span class="mi">1</span><span class="p">:</span> <span class="s">&#39;Auto&#39;</span><span class="p">,</span>
              <span class="mi">2</span><span class="p">:</span> <span class="s">&#39;Tungsten&#39;</span><span class="p">,</span>
              <span class="mi">3</span><span class="p">:</span> <span class="s">&#39;Daylight&#39;</span><span class="p">,</span>
              <span class="mi">4</span><span class="p">:</span> <span class="s">&#39;Fluorescent&#39;</span><span class="p">,</span>
              <span class="mi">5</span><span class="p">:</span> <span class="s">&#39;Shade&#39;</span><span class="p">,</span>
              <span class="mi">129</span><span class="p">:</span> <span class="s">&#39;Manual&#39;</span><span class="p">}),</span>
    <span class="mh">0x000B</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;Sharpness&#39;</span><span class="p">,</span>
             <span class="p">{</span><span class="mi">0</span><span class="p">:</span> <span class="s">&#39;Normal&#39;</span><span class="p">,</span>
              <span class="mi">1</span><span class="p">:</span> <span class="s">&#39;Soft&#39;</span><span class="p">,</span>
              <span class="mi">2</span><span class="p">:</span> <span class="s">&#39;Hard&#39;</span><span class="p">}),</span>
    <span class="mh">0x000C</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;Contrast&#39;</span><span class="p">,</span>
             <span class="p">{</span><span class="mi">0</span><span class="p">:</span> <span class="s">&#39;Normal&#39;</span><span class="p">,</span>
              <span class="mi">1</span><span class="p">:</span> <span class="s">&#39;Low&#39;</span><span class="p">,</span>
              <span class="mi">2</span><span class="p">:</span> <span class="s">&#39;High&#39;</span><span class="p">}),</span>
    <span class="mh">0x000D</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;Saturation&#39;</span><span class="p">,</span>
             <span class="p">{</span><span class="mi">0</span><span class="p">:</span> <span class="s">&#39;Normal&#39;</span><span class="p">,</span>
              <span class="mi">1</span><span class="p">:</span> <span class="s">&#39;Low&#39;</span><span class="p">,</span>
              <span class="mi">2</span><span class="p">:</span> <span class="s">&#39;High&#39;</span><span class="p">}),</span>
    <span class="mh">0x0014</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;CCDSpeed&#39;</span><span class="p">,</span>
             <span class="p">{</span><span class="mi">64</span><span class="p">:</span> <span class="s">&#39;Normal&#39;</span><span class="p">,</span>
              <span class="mi">80</span><span class="p">:</span> <span class="s">&#39;Normal&#39;</span><span class="p">,</span>
              <span class="mi">100</span><span class="p">:</span> <span class="s">&#39;High&#39;</span><span class="p">,</span>
              <span class="mi">125</span><span class="p">:</span> <span class="s">&#39;+1.0&#39;</span><span class="p">,</span>
              <span class="mi">244</span><span class="p">:</span> <span class="s">&#39;+3.0&#39;</span><span class="p">,</span>
              <span class="mi">250</span><span class="p">:</span> <span class="s">&#39;+2.0&#39;</span><span class="p">}),</span>
    <span class="p">}</span>

<span class="n">MAKERNOTE_FUJIFILM_TAGS</span><span class="o">=</span><span class="p">{</span>
    <span class="mh">0x0000</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;NoteVersion&#39;</span><span class="p">,</span> <span class="n">make_string</span><span class="p">),</span>
    <span class="mh">0x1000</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;Quality&#39;</span><span class="p">,</span> <span class="p">),</span>
    <span class="mh">0x1001</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;Sharpness&#39;</span><span class="p">,</span>
             <span class="p">{</span><span class="mi">1</span><span class="p">:</span> <span class="s">&#39;Soft&#39;</span><span class="p">,</span>
              <span class="mi">2</span><span class="p">:</span> <span class="s">&#39;Soft&#39;</span><span class="p">,</span>
              <span class="mi">3</span><span class="p">:</span> <span class="s">&#39;Normal&#39;</span><span class="p">,</span>
              <span class="mi">4</span><span class="p">:</span> <span class="s">&#39;Hard&#39;</span><span class="p">,</span>
              <span class="mi">5</span><span class="p">:</span> <span class="s">&#39;Hard&#39;</span><span class="p">}),</span>
    <span class="mh">0x1002</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;WhiteBalance&#39;</span><span class="p">,</span>
             <span class="p">{</span><span class="mi">0</span><span class="p">:</span> <span class="s">&#39;Auto&#39;</span><span class="p">,</span>
              <span class="mi">256</span><span class="p">:</span> <span class="s">&#39;Daylight&#39;</span><span class="p">,</span>
              <span class="mi">512</span><span class="p">:</span> <span class="s">&#39;Cloudy&#39;</span><span class="p">,</span>
              <span class="mi">768</span><span class="p">:</span> <span class="s">&#39;DaylightColor-Fluorescent&#39;</span><span class="p">,</span>
              <span class="mi">769</span><span class="p">:</span> <span class="s">&#39;DaywhiteColor-Fluorescent&#39;</span><span class="p">,</span>
              <span class="mi">770</span><span class="p">:</span> <span class="s">&#39;White-Fluorescent&#39;</span><span class="p">,</span>
              <span class="mi">1024</span><span class="p">:</span> <span class="s">&#39;Incandescent&#39;</span><span class="p">,</span>
              <span class="mi">3840</span><span class="p">:</span> <span class="s">&#39;Custom&#39;</span><span class="p">}),</span>
    <span class="mh">0x1003</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;Color&#39;</span><span class="p">,</span>
             <span class="p">{</span><span class="mi">0</span><span class="p">:</span> <span class="s">&#39;Normal&#39;</span><span class="p">,</span>
              <span class="mi">256</span><span class="p">:</span> <span class="s">&#39;High&#39;</span><span class="p">,</span>
              <span class="mi">512</span><span class="p">:</span> <span class="s">&#39;Low&#39;</span><span class="p">}),</span>
    <span class="mh">0x1004</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;Tone&#39;</span><span class="p">,</span>
             <span class="p">{</span><span class="mi">0</span><span class="p">:</span> <span class="s">&#39;Normal&#39;</span><span class="p">,</span>
              <span class="mi">256</span><span class="p">:</span> <span class="s">&#39;High&#39;</span><span class="p">,</span>
              <span class="mi">512</span><span class="p">:</span> <span class="s">&#39;Low&#39;</span><span class="p">}),</span>
    <span class="mh">0x1010</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;FlashMode&#39;</span><span class="p">,</span>
             <span class="p">{</span><span class="mi">0</span><span class="p">:</span> <span class="s">&#39;Auto&#39;</span><span class="p">,</span>
              <span class="mi">1</span><span class="p">:</span> <span class="s">&#39;On&#39;</span><span class="p">,</span>
              <span class="mi">2</span><span class="p">:</span> <span class="s">&#39;Off&#39;</span><span class="p">,</span>
              <span class="mi">3</span><span class="p">:</span> <span class="s">&#39;Red Eye Reduction&#39;</span><span class="p">}),</span>
    <span class="mh">0x1011</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;FlashStrength&#39;</span><span class="p">,</span> <span class="p">),</span>
    <span class="mh">0x1020</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;Macro&#39;</span><span class="p">,</span>
             <span class="p">{</span><span class="mi">0</span><span class="p">:</span> <span class="s">&#39;Off&#39;</span><span class="p">,</span>
              <span class="mi">1</span><span class="p">:</span> <span class="s">&#39;On&#39;</span><span class="p">}),</span>
    <span class="mh">0x1021</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;FocusMode&#39;</span><span class="p">,</span>
             <span class="p">{</span><span class="mi">0</span><span class="p">:</span> <span class="s">&#39;Auto&#39;</span><span class="p">,</span>
              <span class="mi">1</span><span class="p">:</span> <span class="s">&#39;Manual&#39;</span><span class="p">}),</span>
    <span class="mh">0x1030</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;SlowSync&#39;</span><span class="p">,</span>
             <span class="p">{</span><span class="mi">0</span><span class="p">:</span> <span class="s">&#39;Off&#39;</span><span class="p">,</span>
              <span class="mi">1</span><span class="p">:</span> <span class="s">&#39;On&#39;</span><span class="p">}),</span>
    <span class="mh">0x1031</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;PictureMode&#39;</span><span class="p">,</span>
             <span class="p">{</span><span class="mi">0</span><span class="p">:</span> <span class="s">&#39;Auto&#39;</span><span class="p">,</span>
              <span class="mi">1</span><span class="p">:</span> <span class="s">&#39;Portrait&#39;</span><span class="p">,</span>
              <span class="mi">2</span><span class="p">:</span> <span class="s">&#39;Landscape&#39;</span><span class="p">,</span>
              <span class="mi">4</span><span class="p">:</span> <span class="s">&#39;Sports&#39;</span><span class="p">,</span>
              <span class="mi">5</span><span class="p">:</span> <span class="s">&#39;Night&#39;</span><span class="p">,</span>
              <span class="mi">6</span><span class="p">:</span> <span class="s">&#39;Program AE&#39;</span><span class="p">,</span>
              <span class="mi">256</span><span class="p">:</span> <span class="s">&#39;Aperture Priority AE&#39;</span><span class="p">,</span>
              <span class="mi">512</span><span class="p">:</span> <span class="s">&#39;Shutter Priority AE&#39;</span><span class="p">,</span>
              <span class="mi">768</span><span class="p">:</span> <span class="s">&#39;Manual Exposure&#39;</span><span class="p">}),</span>
    <span class="mh">0x1100</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;MotorOrBracket&#39;</span><span class="p">,</span>
             <span class="p">{</span><span class="mi">0</span><span class="p">:</span> <span class="s">&#39;Off&#39;</span><span class="p">,</span>
              <span class="mi">1</span><span class="p">:</span> <span class="s">&#39;On&#39;</span><span class="p">}),</span>
    <span class="mh">0x1300</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;BlurWarning&#39;</span><span class="p">,</span>
             <span class="p">{</span><span class="mi">0</span><span class="p">:</span> <span class="s">&#39;Off&#39;</span><span class="p">,</span>
              <span class="mi">1</span><span class="p">:</span> <span class="s">&#39;On&#39;</span><span class="p">}),</span>
    <span class="mh">0x1301</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;FocusWarning&#39;</span><span class="p">,</span>
             <span class="p">{</span><span class="mi">0</span><span class="p">:</span> <span class="s">&#39;Off&#39;</span><span class="p">,</span>
              <span class="mi">1</span><span class="p">:</span> <span class="s">&#39;On&#39;</span><span class="p">}),</span>
    <span class="mh">0x1302</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;AEWarning&#39;</span><span class="p">,</span>
             <span class="p">{</span><span class="mi">0</span><span class="p">:</span> <span class="s">&#39;Off&#39;</span><span class="p">,</span>
              <span class="mi">1</span><span class="p">:</span> <span class="s">&#39;On&#39;</span><span class="p">}),</span>
    <span class="p">}</span>

<span class="n">MAKERNOTE_CANON_TAGS</span> <span class="o">=</span> <span class="p">{</span>
    <span class="mh">0x0006</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;ImageType&#39;</span><span class="p">,</span> <span class="p">),</span>
    <span class="mh">0x0007</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;FirmwareVersion&#39;</span><span class="p">,</span> <span class="p">),</span>
    <span class="mh">0x0008</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;ImageNumber&#39;</span><span class="p">,</span> <span class="p">),</span>
    <span class="mh">0x0009</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;OwnerName&#39;</span><span class="p">,</span> <span class="p">),</span>
    <span class="p">}</span>

<span class="c"># this is in element offset, name, optional value dictionary format</span>
<span class="n">MAKERNOTE_CANON_TAG_0x001</span> <span class="o">=</span> <span class="p">{</span>
    <span class="mi">1</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;Macromode&#39;</span><span class="p">,</span>
        <span class="p">{</span><span class="mi">1</span><span class="p">:</span> <span class="s">&#39;Macro&#39;</span><span class="p">,</span>
         <span class="mi">2</span><span class="p">:</span> <span class="s">&#39;Normal&#39;</span><span class="p">}),</span>
    <span class="mi">2</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;SelfTimer&#39;</span><span class="p">,</span> <span class="p">),</span>
    <span class="mi">3</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;Quality&#39;</span><span class="p">,</span>
        <span class="p">{</span><span class="mi">2</span><span class="p">:</span> <span class="s">&#39;Normal&#39;</span><span class="p">,</span>
         <span class="mi">3</span><span class="p">:</span> <span class="s">&#39;Fine&#39;</span><span class="p">,</span>
         <span class="mi">5</span><span class="p">:</span> <span class="s">&#39;Superfine&#39;</span><span class="p">}),</span>
    <span class="mi">4</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;FlashMode&#39;</span><span class="p">,</span>
        <span class="p">{</span><span class="mi">0</span><span class="p">:</span> <span class="s">&#39;Flash Not Fired&#39;</span><span class="p">,</span>
         <span class="mi">1</span><span class="p">:</span> <span class="s">&#39;Auto&#39;</span><span class="p">,</span>
         <span class="mi">2</span><span class="p">:</span> <span class="s">&#39;On&#39;</span><span class="p">,</span>
         <span class="mi">3</span><span class="p">:</span> <span class="s">&#39;Red-Eye Reduction&#39;</span><span class="p">,</span>
         <span class="mi">4</span><span class="p">:</span> <span class="s">&#39;Slow Synchro&#39;</span><span class="p">,</span>
         <span class="mi">5</span><span class="p">:</span> <span class="s">&#39;Auto + Red-Eye Reduction&#39;</span><span class="p">,</span>
         <span class="mi">6</span><span class="p">:</span> <span class="s">&#39;On + Red-Eye Reduction&#39;</span><span class="p">,</span>
         <span class="mi">16</span><span class="p">:</span> <span class="s">&#39;external flash&#39;</span><span class="p">}),</span>
    <span class="mi">5</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;ContinuousDriveMode&#39;</span><span class="p">,</span>
        <span class="p">{</span><span class="mi">0</span><span class="p">:</span> <span class="s">&#39;Single Or Timer&#39;</span><span class="p">,</span>
         <span class="mi">1</span><span class="p">:</span> <span class="s">&#39;Continuous&#39;</span><span class="p">}),</span>
    <span class="mi">7</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;FocusMode&#39;</span><span class="p">,</span>
        <span class="p">{</span><span class="mi">0</span><span class="p">:</span> <span class="s">&#39;One-Shot&#39;</span><span class="p">,</span>
         <span class="mi">1</span><span class="p">:</span> <span class="s">&#39;AI Servo&#39;</span><span class="p">,</span>
         <span class="mi">2</span><span class="p">:</span> <span class="s">&#39;AI Focus&#39;</span><span class="p">,</span>
         <span class="mi">3</span><span class="p">:</span> <span class="s">&#39;MF&#39;</span><span class="p">,</span>
         <span class="mi">4</span><span class="p">:</span> <span class="s">&#39;Single&#39;</span><span class="p">,</span>
         <span class="mi">5</span><span class="p">:</span> <span class="s">&#39;Continuous&#39;</span><span class="p">,</span>
         <span class="mi">6</span><span class="p">:</span> <span class="s">&#39;MF&#39;</span><span class="p">}),</span>
    <span class="mi">10</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;ImageSize&#39;</span><span class="p">,</span>
         <span class="p">{</span><span class="mi">0</span><span class="p">:</span> <span class="s">&#39;Large&#39;</span><span class="p">,</span>
          <span class="mi">1</span><span class="p">:</span> <span class="s">&#39;Medium&#39;</span><span class="p">,</span>
          <span class="mi">2</span><span class="p">:</span> <span class="s">&#39;Small&#39;</span><span class="p">}),</span>
    <span class="mi">11</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;EasyShootingMode&#39;</span><span class="p">,</span>
         <span class="p">{</span><span class="mi">0</span><span class="p">:</span> <span class="s">&#39;Full Auto&#39;</span><span class="p">,</span>
          <span class="mi">1</span><span class="p">:</span> <span class="s">&#39;Manual&#39;</span><span class="p">,</span>
          <span class="mi">2</span><span class="p">:</span> <span class="s">&#39;Landscape&#39;</span><span class="p">,</span>
          <span class="mi">3</span><span class="p">:</span> <span class="s">&#39;Fast Shutter&#39;</span><span class="p">,</span>
          <span class="mi">4</span><span class="p">:</span> <span class="s">&#39;Slow Shutter&#39;</span><span class="p">,</span>
          <span class="mi">5</span><span class="p">:</span> <span class="s">&#39;Night&#39;</span><span class="p">,</span>
          <span class="mi">6</span><span class="p">:</span> <span class="s">&#39;B&amp;W&#39;</span><span class="p">,</span>
          <span class="mi">7</span><span class="p">:</span> <span class="s">&#39;Sepia&#39;</span><span class="p">,</span>
          <span class="mi">8</span><span class="p">:</span> <span class="s">&#39;Portrait&#39;</span><span class="p">,</span>
          <span class="mi">9</span><span class="p">:</span> <span class="s">&#39;Sports&#39;</span><span class="p">,</span>
          <span class="mi">10</span><span class="p">:</span> <span class="s">&#39;Macro/Close-Up&#39;</span><span class="p">,</span>
          <span class="mi">11</span><span class="p">:</span> <span class="s">&#39;Pan Focus&#39;</span><span class="p">}),</span>
    <span class="mi">12</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;DigitalZoom&#39;</span><span class="p">,</span>
         <span class="p">{</span><span class="mi">0</span><span class="p">:</span> <span class="s">&#39;None&#39;</span><span class="p">,</span>
          <span class="mi">1</span><span class="p">:</span> <span class="s">&#39;2x&#39;</span><span class="p">,</span>
          <span class="mi">2</span><span class="p">:</span> <span class="s">&#39;4x&#39;</span><span class="p">}),</span>
    <span class="mi">13</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;Contrast&#39;</span><span class="p">,</span>
         <span class="p">{</span><span class="mh">0xFFFF</span><span class="p">:</span> <span class="s">&#39;Low&#39;</span><span class="p">,</span>
          <span class="mi">0</span><span class="p">:</span> <span class="s">&#39;Normal&#39;</span><span class="p">,</span>
          <span class="mi">1</span><span class="p">:</span> <span class="s">&#39;High&#39;</span><span class="p">}),</span>
    <span class="mi">14</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;Saturation&#39;</span><span class="p">,</span>
         <span class="p">{</span><span class="mh">0xFFFF</span><span class="p">:</span> <span class="s">&#39;Low&#39;</span><span class="p">,</span>
          <span class="mi">0</span><span class="p">:</span> <span class="s">&#39;Normal&#39;</span><span class="p">,</span>
          <span class="mi">1</span><span class="p">:</span> <span class="s">&#39;High&#39;</span><span class="p">}),</span>
    <span class="mi">15</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;Sharpness&#39;</span><span class="p">,</span>
         <span class="p">{</span><span class="mh">0xFFFF</span><span class="p">:</span> <span class="s">&#39;Low&#39;</span><span class="p">,</span>
          <span class="mi">0</span><span class="p">:</span> <span class="s">&#39;Normal&#39;</span><span class="p">,</span>
          <span class="mi">1</span><span class="p">:</span> <span class="s">&#39;High&#39;</span><span class="p">}),</span>
    <span class="mi">16</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;ISO&#39;</span><span class="p">,</span>
         <span class="p">{</span><span class="mi">0</span><span class="p">:</span> <span class="s">&#39;See ISOSpeedRatings Tag&#39;</span><span class="p">,</span>
          <span class="mi">15</span><span class="p">:</span> <span class="s">&#39;Auto&#39;</span><span class="p">,</span>
          <span class="mi">16</span><span class="p">:</span> <span class="s">&#39;50&#39;</span><span class="p">,</span>
          <span class="mi">17</span><span class="p">:</span> <span class="s">&#39;100&#39;</span><span class="p">,</span>
          <span class="mi">18</span><span class="p">:</span> <span class="s">&#39;200&#39;</span><span class="p">,</span>
          <span class="mi">19</span><span class="p">:</span> <span class="s">&#39;400&#39;</span><span class="p">}),</span>
    <span class="mi">17</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;MeteringMode&#39;</span><span class="p">,</span>
         <span class="p">{</span><span class="mi">3</span><span class="p">:</span> <span class="s">&#39;Evaluative&#39;</span><span class="p">,</span>
          <span class="mi">4</span><span class="p">:</span> <span class="s">&#39;Partial&#39;</span><span class="p">,</span>
          <span class="mi">5</span><span class="p">:</span> <span class="s">&#39;Center-weighted&#39;</span><span class="p">}),</span>
    <span class="mi">18</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;FocusType&#39;</span><span class="p">,</span>
         <span class="p">{</span><span class="mi">0</span><span class="p">:</span> <span class="s">&#39;Manual&#39;</span><span class="p">,</span>
          <span class="mi">1</span><span class="p">:</span> <span class="s">&#39;Auto&#39;</span><span class="p">,</span>
          <span class="mi">3</span><span class="p">:</span> <span class="s">&#39;Close-Up (Macro)&#39;</span><span class="p">,</span>
          <span class="mi">8</span><span class="p">:</span> <span class="s">&#39;Locked (Pan Mode)&#39;</span><span class="p">}),</span>
    <span class="mi">19</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;AFPointSelected&#39;</span><span class="p">,</span>
         <span class="p">{</span><span class="mh">0x3000</span><span class="p">:</span> <span class="s">&#39;None (MF)&#39;</span><span class="p">,</span>
          <span class="mh">0x3001</span><span class="p">:</span> <span class="s">&#39;Auto-Selected&#39;</span><span class="p">,</span>
          <span class="mh">0x3002</span><span class="p">:</span> <span class="s">&#39;Right&#39;</span><span class="p">,</span>
          <span class="mh">0x3003</span><span class="p">:</span> <span class="s">&#39;Center&#39;</span><span class="p">,</span>
          <span class="mh">0x3004</span><span class="p">:</span> <span class="s">&#39;Left&#39;</span><span class="p">}),</span>
    <span class="mi">20</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;ExposureMode&#39;</span><span class="p">,</span>
         <span class="p">{</span><span class="mi">0</span><span class="p">:</span> <span class="s">&#39;Easy Shooting&#39;</span><span class="p">,</span>
          <span class="mi">1</span><span class="p">:</span> <span class="s">&#39;Program&#39;</span><span class="p">,</span>
          <span class="mi">2</span><span class="p">:</span> <span class="s">&#39;Tv-priority&#39;</span><span class="p">,</span>
          <span class="mi">3</span><span class="p">:</span> <span class="s">&#39;Av-priority&#39;</span><span class="p">,</span>
          <span class="mi">4</span><span class="p">:</span> <span class="s">&#39;Manual&#39;</span><span class="p">,</span>
          <span class="mi">5</span><span class="p">:</span> <span class="s">&#39;A-DEP&#39;</span><span class="p">}),</span>
    <span class="mi">23</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;LongFocalLengthOfLensInFocalUnits&#39;</span><span class="p">,</span> <span class="p">),</span>
    <span class="mi">24</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;ShortFocalLengthOfLensInFocalUnits&#39;</span><span class="p">,</span> <span class="p">),</span>
    <span class="mi">25</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;FocalUnitsPerMM&#39;</span><span class="p">,</span> <span class="p">),</span>
    <span class="mi">28</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;FlashActivity&#39;</span><span class="p">,</span>
         <span class="p">{</span><span class="mi">0</span><span class="p">:</span> <span class="s">&#39;Did Not Fire&#39;</span><span class="p">,</span>
          <span class="mi">1</span><span class="p">:</span> <span class="s">&#39;Fired&#39;</span><span class="p">}),</span>
    <span class="mi">29</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;FlashDetails&#39;</span><span class="p">,</span>
         <span class="p">{</span><span class="mi">14</span><span class="p">:</span> <span class="s">&#39;External E-TTL&#39;</span><span class="p">,</span>
          <span class="mi">13</span><span class="p">:</span> <span class="s">&#39;Internal Flash&#39;</span><span class="p">,</span>
          <span class="mi">11</span><span class="p">:</span> <span class="s">&#39;FP Sync Used&#39;</span><span class="p">,</span>
          <span class="mi">7</span><span class="p">:</span> <span class="s">&#39;2nd(&quot;Rear&quot;)-Curtain Sync Used&#39;</span><span class="p">,</span>
          <span class="mi">4</span><span class="p">:</span> <span class="s">&#39;FP Sync Enabled&#39;</span><span class="p">}),</span>
    <span class="mi">32</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;FocusMode&#39;</span><span class="p">,</span>
         <span class="p">{</span><span class="mi">0</span><span class="p">:</span> <span class="s">&#39;Single&#39;</span><span class="p">,</span>
          <span class="mi">1</span><span class="p">:</span> <span class="s">&#39;Continuous&#39;</span><span class="p">}),</span>
    <span class="p">}</span>

<span class="n">MAKERNOTE_CANON_TAG_0x004</span> <span class="o">=</span> <span class="p">{</span>
    <span class="mi">7</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;WhiteBalance&#39;</span><span class="p">,</span>
        <span class="p">{</span><span class="mi">0</span><span class="p">:</span> <span class="s">&#39;Auto&#39;</span><span class="p">,</span>
         <span class="mi">1</span><span class="p">:</span> <span class="s">&#39;Sunny&#39;</span><span class="p">,</span>
         <span class="mi">2</span><span class="p">:</span> <span class="s">&#39;Cloudy&#39;</span><span class="p">,</span>
         <span class="mi">3</span><span class="p">:</span> <span class="s">&#39;Tungsten&#39;</span><span class="p">,</span>
         <span class="mi">4</span><span class="p">:</span> <span class="s">&#39;Fluorescent&#39;</span><span class="p">,</span>
         <span class="mi">5</span><span class="p">:</span> <span class="s">&#39;Flash&#39;</span><span class="p">,</span>
         <span class="mi">6</span><span class="p">:</span> <span class="s">&#39;Custom&#39;</span><span class="p">}),</span>
    <span class="mi">9</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;SequenceNumber&#39;</span><span class="p">,</span> <span class="p">),</span>
    <span class="mi">14</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;AFPointUsed&#39;</span><span class="p">,</span> <span class="p">),</span>
    <span class="mi">15</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;FlashBias&#39;</span><span class="p">,</span>
        <span class="p">{</span><span class="mh">0XFFC0</span><span class="p">:</span> <span class="s">&#39;-2 EV&#39;</span><span class="p">,</span>
         <span class="mh">0XFFCC</span><span class="p">:</span> <span class="s">&#39;-1.67 EV&#39;</span><span class="p">,</span>
         <span class="mh">0XFFD0</span><span class="p">:</span> <span class="s">&#39;-1.50 EV&#39;</span><span class="p">,</span>
         <span class="mh">0XFFD4</span><span class="p">:</span> <span class="s">&#39;-1.33 EV&#39;</span><span class="p">,</span>
         <span class="mh">0XFFE0</span><span class="p">:</span> <span class="s">&#39;-1 EV&#39;</span><span class="p">,</span>
         <span class="mh">0XFFEC</span><span class="p">:</span> <span class="s">&#39;-0.67 EV&#39;</span><span class="p">,</span>
         <span class="mh">0XFFF0</span><span class="p">:</span> <span class="s">&#39;-0.50 EV&#39;</span><span class="p">,</span>
         <span class="mh">0XFFF4</span><span class="p">:</span> <span class="s">&#39;-0.33 EV&#39;</span><span class="p">,</span>
         <span class="mh">0X0000</span><span class="p">:</span> <span class="s">&#39;0 EV&#39;</span><span class="p">,</span>
         <span class="mh">0X000C</span><span class="p">:</span> <span class="s">&#39;0.33 EV&#39;</span><span class="p">,</span>
         <span class="mh">0X0010</span><span class="p">:</span> <span class="s">&#39;0.50 EV&#39;</span><span class="p">,</span>
         <span class="mh">0X0014</span><span class="p">:</span> <span class="s">&#39;0.67 EV&#39;</span><span class="p">,</span>
         <span class="mh">0X0020</span><span class="p">:</span> <span class="s">&#39;1 EV&#39;</span><span class="p">,</span>
         <span class="mh">0X002C</span><span class="p">:</span> <span class="s">&#39;1.33 EV&#39;</span><span class="p">,</span>
         <span class="mh">0X0030</span><span class="p">:</span> <span class="s">&#39;1.50 EV&#39;</span><span class="p">,</span>
         <span class="mh">0X0034</span><span class="p">:</span> <span class="s">&#39;1.67 EV&#39;</span><span class="p">,</span>
         <span class="mh">0X0040</span><span class="p">:</span> <span class="s">&#39;2 EV&#39;</span><span class="p">}),</span>
    <span class="mi">19</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;SubjectDistance&#39;</span><span class="p">,</span> <span class="p">),</span>
    <span class="p">}</span>

<span class="c"># extract multibyte integer in Motorola format (little endian)</span>
<div class="viewcode-block" id="s2n_motorola"><a class="viewcode-back" href="../../../../pytomo.kaa_metadata.image.html#pytomo.kaa_metadata.image.EXIF.s2n_motorola">[docs]</a><span class="k">def</span> <span class="nf">s2n_motorola</span><span class="p">(</span><span class="nb">str</span><span class="p">):</span>
    <span class="n">x</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="nb">str</span><span class="p">:</span>
        <span class="n">x</span> <span class="o">=</span> <span class="p">(</span><span class="n">x</span> <span class="o">&lt;&lt;</span> <span class="mi">8</span><span class="p">)</span> <span class="o">|</span> <span class="nb">ord</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">x</span>

<span class="c"># extract multibyte integer in Intel format (big endian)</span></div>
<div class="viewcode-block" id="s2n_intel"><a class="viewcode-back" href="../../../../pytomo.kaa_metadata.image.html#pytomo.kaa_metadata.image.EXIF.s2n_intel">[docs]</a><span class="k">def</span> <span class="nf">s2n_intel</span><span class="p">(</span><span class="nb">str</span><span class="p">):</span>
    <span class="n">x</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">y</span> <span class="o">=</span> <span class="il">0L</span>
    <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="nb">str</span><span class="p">:</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">x</span> <span class="o">|</span> <span class="p">(</span><span class="nb">ord</span><span class="p">(</span><span class="n">c</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="n">y</span><span class="p">)</span>
        <span class="n">y</span> <span class="o">=</span> <span class="n">y</span> <span class="o">+</span> <span class="mi">8</span>
    <span class="k">return</span> <span class="n">x</span>

<span class="c"># ratio object that eventually will be able to reduce itself to lowest</span>
<span class="c"># common denominator for printing</span></div>
<div class="viewcode-block" id="gcd"><a class="viewcode-back" href="../../../../pytomo.kaa_metadata.image.html#pytomo.kaa_metadata.image.EXIF.gcd">[docs]</a><span class="k">def</span> <span class="nf">gcd</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">b</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">a</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">gcd</span><span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="n">a</span> <span class="o">%</span> <span class="n">b</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="Ratio"><a class="viewcode-back" href="../../../../pytomo.kaa_metadata.image.html#pytomo.kaa_metadata.image.EXIF.Ratio">[docs]</a><span class="k">class</span> <span class="nc">Ratio</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">num</span><span class="p">,</span> <span class="n">den</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">num</span> <span class="o">=</span> <span class="n">num</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">den</span> <span class="o">=</span> <span class="n">den</span>

    <span class="k">def</span> <span class="nf">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">reduce</span><span class="p">()</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">den</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">num</span><span class="p">)</span>
        <span class="k">return</span> <span class="s">&#39;</span><span class="si">%d</span><span class="s">/</span><span class="si">%d</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">num</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">den</span><span class="p">)</span>

<div class="viewcode-block" id="Ratio.reduce"><a class="viewcode-back" href="../../../../pytomo.kaa_metadata.image.html#pytomo.kaa_metadata.image.EXIF.Ratio.reduce">[docs]</a>    <span class="k">def</span> <span class="nf">reduce</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">div</span> <span class="o">=</span> <span class="n">gcd</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">num</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">den</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">div</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">num</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">num</span> <span class="o">/</span> <span class="n">div</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">den</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">den</span> <span class="o">/</span> <span class="n">div</span>

<span class="c"># for ease of dealing with tags</span></div></div>
<div class="viewcode-block" id="IFD_Tag"><a class="viewcode-back" href="../../../../pytomo.kaa_metadata.image.html#pytomo.kaa_metadata.image.EXIF.IFD_Tag">[docs]</a><span class="k">class</span> <span class="nc">IFD_Tag</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">printable</span><span class="p">,</span> <span class="n">tag</span><span class="p">,</span> <span class="n">field_type</span><span class="p">,</span> <span class="n">values</span><span class="p">,</span> <span class="n">field_offset</span><span class="p">,</span>
                 <span class="n">field_length</span><span class="p">):</span>
        <span class="c"># printable version of data</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">printable</span> <span class="o">=</span> <span class="n">printable</span>
        <span class="c"># tag ID number</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tag</span> <span class="o">=</span> <span class="n">tag</span>
        <span class="c"># field type as index into FIELD_TYPES</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">field_type</span> <span class="o">=</span> <span class="n">field_type</span>
        <span class="c"># offset of start of field in bytes from beginning of IFD</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">field_offset</span> <span class="o">=</span> <span class="n">field_offset</span>
        <span class="c"># length of data field in bytes</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">field_length</span> <span class="o">=</span> <span class="n">field_length</span>
        <span class="c"># either a string or array of data items</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">values</span> <span class="o">=</span> <span class="n">values</span>

    <span class="k">def</span> <span class="nf">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">printable</span>

    <span class="k">def</span> <span class="nf">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s">&#39;(0x</span><span class="si">%04X</span><span class="s">) </span><span class="si">%s</span><span class="s">=</span><span class="si">%s</span><span class="s"> @ </span><span class="si">%d</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tag</span><span class="p">,</span>
                                        <span class="n">FIELD_TYPES</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">field_type</span><span class="p">][</span><span class="mi">2</span><span class="p">],</span>
                                        <span class="bp">self</span><span class="o">.</span><span class="n">printable</span><span class="p">,</span>
                                        <span class="bp">self</span><span class="o">.</span><span class="n">field_offset</span><span class="p">)</span>

<span class="c"># class that handles an EXIF header</span></div>
<div class="viewcode-block" id="EXIF_header"><a class="viewcode-back" href="../../../../pytomo.kaa_metadata.image.html#pytomo.kaa_metadata.image.EXIF.EXIF_header">[docs]</a><span class="k">class</span> <span class="nc">EXIF_header</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">file</span><span class="p">,</span> <span class="n">endian</span><span class="p">,</span> <span class="n">offset</span><span class="p">,</span> <span class="n">fake_exif</span><span class="p">,</span> <span class="n">debug</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">file</span> <span class="o">=</span> <span class="nb">file</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">endian</span> <span class="o">=</span> <span class="n">endian</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">offset</span> <span class="o">=</span> <span class="n">offset</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fake_exif</span> <span class="o">=</span> <span class="n">fake_exif</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">debug</span> <span class="o">=</span> <span class="n">debug</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tags</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="c"># convert slice to integer, based on sign and endian flags</span>
    <span class="c"># usually this offset is assumed to be relative to the beginning of the</span>
    <span class="c"># start of the EXIF information.  For some cameras that use relative tags,</span>
    <span class="c"># this offset may be relative to some other starting point.</span>
<div class="viewcode-block" id="EXIF_header.s2n"><a class="viewcode-back" href="../../../../pytomo.kaa_metadata.image.html#pytomo.kaa_metadata.image.EXIF.EXIF_header.s2n">[docs]</a>    <span class="k">def</span> <span class="nf">s2n</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">offset</span><span class="p">,</span> <span class="n">length</span><span class="p">,</span> <span class="n">signed</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">file</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">offset</span><span class="o">+</span><span class="n">offset</span><span class="p">)</span>
        <span class="nb">slice</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">file</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">length</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">endian</span> <span class="o">==</span> <span class="s">&#39;I&#39;</span><span class="p">:</span>
            <span class="n">val</span><span class="o">=</span><span class="n">s2n_intel</span><span class="p">(</span><span class="nb">slice</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">val</span><span class="o">=</span><span class="n">s2n_motorola</span><span class="p">(</span><span class="nb">slice</span><span class="p">)</span>
        <span class="c"># Sign extension ?</span>
        <span class="k">if</span> <span class="n">signed</span><span class="p">:</span>
            <span class="n">msb</span><span class="o">=</span><span class="il">1L</span> <span class="o">&lt;&lt;</span> <span class="p">(</span><span class="mi">8</span><span class="o">*</span><span class="n">length</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">val</span> <span class="o">&amp;</span> <span class="n">msb</span><span class="p">:</span>
                <span class="n">val</span><span class="o">=</span><span class="n">val</span><span class="o">-</span><span class="p">(</span><span class="n">msb</span> <span class="o">&lt;&lt;</span> <span class="mi">1</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">val</span>

    <span class="c"># convert offset to string</span></div>
<div class="viewcode-block" id="EXIF_header.n2s"><a class="viewcode-back" href="../../../../pytomo.kaa_metadata.image.html#pytomo.kaa_metadata.image.EXIF.EXIF_header.n2s">[docs]</a>    <span class="k">def</span> <span class="nf">n2s</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">offset</span><span class="p">,</span> <span class="n">length</span><span class="p">):</span>
        <span class="n">s</span> <span class="o">=</span> <span class="s">&#39;&#39;</span>
        <span class="k">for</span> <span class="n">dummy</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">length</span><span class="p">):</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">endian</span> <span class="o">==</span> <span class="s">&#39;I&#39;</span><span class="p">:</span>
                <span class="n">s</span> <span class="o">=</span> <span class="n">s</span> <span class="o">+</span> <span class="nb">chr</span><span class="p">(</span><span class="n">offset</span> <span class="o">&amp;</span> <span class="mh">0xFF</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">s</span> <span class="o">=</span> <span class="nb">chr</span><span class="p">(</span><span class="n">offset</span> <span class="o">&amp;</span> <span class="mh">0xFF</span><span class="p">)</span> <span class="o">+</span> <span class="n">s</span>
            <span class="n">offset</span> <span class="o">=</span> <span class="n">offset</span> <span class="o">&gt;&gt;</span> <span class="mi">8</span>
        <span class="k">return</span> <span class="n">s</span>

    <span class="c"># return first IFD</span></div>
<div class="viewcode-block" id="EXIF_header.first_IFD"><a class="viewcode-back" href="../../../../pytomo.kaa_metadata.image.html#pytomo.kaa_metadata.image.EXIF.EXIF_header.first_IFD">[docs]</a>    <span class="k">def</span> <span class="nf">first_IFD</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">s2n</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>

    <span class="c"># return pointer to next IFD</span></div>
<div class="viewcode-block" id="EXIF_header.next_IFD"><a class="viewcode-back" href="../../../../pytomo.kaa_metadata.image.html#pytomo.kaa_metadata.image.EXIF.EXIF_header.next_IFD">[docs]</a>    <span class="k">def</span> <span class="nf">next_IFD</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ifd</span><span class="p">):</span>
        <span class="n">entries</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">s2n</span><span class="p">(</span><span class="n">ifd</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">s2n</span><span class="p">(</span><span class="n">ifd</span><span class="o">+</span><span class="mi">2</span><span class="o">+</span><span class="mi">12</span><span class="o">*</span><span class="n">entries</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>

    <span class="c"># return list of IFDs in header</span></div>
<div class="viewcode-block" id="EXIF_header.list_IFDs"><a class="viewcode-back" href="../../../../pytomo.kaa_metadata.image.html#pytomo.kaa_metadata.image.EXIF.EXIF_header.list_IFDs">[docs]</a>    <span class="k">def</span> <span class="nf">list_IFDs</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">i</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">first_IFD</span><span class="p">()</span>
        <span class="n">a</span><span class="o">=</span><span class="p">[]</span>
        <span class="k">while</span> <span class="n">i</span><span class="p">:</span>
            <span class="c"># kaa_metadata addition: I have an image that wants to read from</span>
            <span class="c"># the next position 1229608262. This is nonsense (I hope). </span>
            <span class="k">if</span> <span class="n">i</span> <span class="o">&gt;</span> <span class="mi">10000</span><span class="p">:</span>
                <span class="k">break</span>
            <span class="n">a</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
            <span class="n">i</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">next_IFD</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">a</span>

    <span class="c"># return list of entries in this IFD</span></div>
<div class="viewcode-block" id="EXIF_header.dump_IFD"><a class="viewcode-back" href="../../../../pytomo.kaa_metadata.image.html#pytomo.kaa_metadata.image.EXIF.EXIF_header.dump_IFD">[docs]</a>    <span class="k">def</span> <span class="nf">dump_IFD</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ifd</span><span class="p">,</span> <span class="n">ifd_name</span><span class="p">,</span> <span class="nb">dict</span><span class="o">=</span><span class="n">EXIF_TAGS</span><span class="p">,</span> <span class="n">relative</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">stop_tag</span><span class="o">=</span><span class="s">&#39;UNDEF&#39;</span><span class="p">):</span>
        <span class="n">entries</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">s2n</span><span class="p">(</span><span class="n">ifd</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">entries</span> <span class="o">&gt;</span> <span class="mi">100</span><span class="p">:</span>
            <span class="c"># kaa_metadata addition: over 100 entries? Are you kidding</span>
            <span class="c"># me? That takes a very long time to decode. I guess</span>
            <span class="c"># something went wrong here (e.g. Olympus maker notes may</span>
            <span class="c"># cause this). Ignore this.</span>
            <span class="k">return</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">entries</span><span class="p">):</span>
            <span class="c"># entry is index of start of this IFD in the file</span>
            <span class="n">entry</span> <span class="o">=</span> <span class="n">ifd</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">+</span> <span class="mi">12</span> <span class="o">*</span> <span class="n">i</span>
            <span class="n">tag</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">s2n</span><span class="p">(</span><span class="n">entry</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>

            <span class="c"># get tag name early to avoid errors, help debug</span>
            <span class="n">tag_entry</span> <span class="o">=</span> <span class="nb">dict</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">tag</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">tag_entry</span><span class="p">:</span>
                <span class="n">tag_name</span> <span class="o">=</span> <span class="n">tag_entry</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">tag_name</span> <span class="o">=</span> <span class="s">&#39;Tag 0x</span><span class="si">%04X</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">tag</span>

            <span class="c"># ignore certain tags for faster processing</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="ow">not</span> <span class="n">detailed</span> <span class="ow">and</span> <span class="n">tag</span> <span class="ow">in</span> <span class="n">IGNORE_TAGS</span><span class="p">):</span>
                <span class="n">field_type</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">s2n</span><span class="p">(</span><span class="n">entry</span> <span class="o">+</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="mi">0</span> <span class="o">&lt;</span> <span class="n">field_type</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">FIELD_TYPES</span><span class="p">):</span>
                    <span class="c"># unknown field type</span>
                    <span class="c"># kaa_metadata addition: do not raise exception, return</span>
                    <span class="c"># what we have right now</span>
                    <span class="k">return</span>
                <span class="n">typelen</span> <span class="o">=</span> <span class="n">FIELD_TYPES</span><span class="p">[</span><span class="n">field_type</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">count</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">s2n</span><span class="p">(</span><span class="n">entry</span> <span class="o">+</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>
                <span class="n">offset</span> <span class="o">=</span> <span class="n">entry</span> <span class="o">+</span> <span class="mi">8</span>
                <span class="k">if</span> <span class="n">count</span> <span class="o">*</span> <span class="n">typelen</span> <span class="o">&gt;</span> <span class="mi">4</span><span class="p">:</span>
                    <span class="c"># offset is not the value; it&#39;s a pointer to the value</span>
                    <span class="c"># if relative we set things up so s2n will seek to the right</span>
                    <span class="c"># place when it adds self.offset.  Note that this &#39;relative&#39;</span>
                    <span class="c"># is for the Nikon type 3 makernote.  Other cameras may use</span>
                    <span class="c"># other relative offsets, which would have to be computed here</span>
                    <span class="c"># slightly differently.</span>
                    <span class="k">if</span> <span class="n">relative</span><span class="p">:</span>
                        <span class="n">tmp_offset</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">s2n</span><span class="p">(</span><span class="n">offset</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>
                        <span class="n">offset</span> <span class="o">=</span> <span class="n">tmp_offset</span> <span class="o">+</span> <span class="n">ifd</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">offset</span> <span class="o">+</span> <span class="mi">4</span>
                        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">fake_exif</span><span class="p">:</span>
                            <span class="n">offset</span> <span class="o">=</span> <span class="n">offset</span> <span class="o">+</span> <span class="mi">18</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">offset</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">s2n</span><span class="p">(</span><span class="n">offset</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>
                <span class="n">field_offset</span> <span class="o">=</span> <span class="n">offset</span>
                <span class="k">if</span> <span class="n">field_type</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                    <span class="c"># special case: null-terminated ASCII string</span>
                    <span class="k">if</span> <span class="n">count</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">file</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">offset</span> <span class="o">+</span> <span class="n">offset</span><span class="p">)</span>
                        <span class="n">values</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">file</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">count</span><span class="p">)</span>
                        <span class="n">values</span> <span class="o">=</span> <span class="n">values</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\x00</span><span class="s">&#39;</span><span class="p">,</span> <span class="s">&#39;&#39;</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">values</span> <span class="o">=</span> <span class="s">&#39;&#39;</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">values</span> <span class="o">=</span> <span class="p">[]</span>
                    <span class="n">signed</span> <span class="o">=</span> <span class="p">(</span><span class="n">field_type</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">6</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">10</span><span class="p">])</span>
                    <span class="k">for</span> <span class="n">dummy</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">count</span><span class="p">):</span>
                        <span class="k">if</span> <span class="n">field_type</span> <span class="ow">in</span> <span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">10</span><span class="p">):</span>
                            <span class="c"># a ratio</span>
                            <span class="n">value</span> <span class="o">=</span> <span class="n">Ratio</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">s2n</span><span class="p">(</span><span class="n">offset</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="n">signed</span><span class="p">),</span>
                                          <span class="bp">self</span><span class="o">.</span><span class="n">s2n</span><span class="p">(</span><span class="n">offset</span> <span class="o">+</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="n">signed</span><span class="p">))</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="n">value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">s2n</span><span class="p">(</span><span class="n">offset</span><span class="p">,</span> <span class="n">typelen</span><span class="p">,</span> <span class="n">signed</span><span class="p">)</span>
                        <span class="n">values</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
                        <span class="n">offset</span> <span class="o">=</span> <span class="n">offset</span> <span class="o">+</span> <span class="n">typelen</span>
                <span class="c"># now &quot;values&quot; is either a string or an array</span>
                <span class="k">if</span> <span class="n">count</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">and</span> <span class="n">field_type</span> <span class="o">!=</span> <span class="mi">2</span><span class="p">:</span>
                    <span class="n">printable</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">printable</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">values</span><span class="p">)</span>
                <span class="c"># compute printable version of values</span>
                <span class="k">if</span> <span class="n">tag_entry</span><span class="p">:</span>
                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">tag_entry</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
                        <span class="c"># optional 2nd tag element is present</span>
                        <span class="k">if</span> <span class="nb">callable</span><span class="p">(</span><span class="n">tag_entry</span><span class="p">[</span><span class="mi">1</span><span class="p">]):</span>
                            <span class="c"># call mapping function</span>
                            <span class="n">printable</span> <span class="o">=</span> <span class="n">tag_entry</span><span class="p">[</span><span class="mi">1</span><span class="p">](</span><span class="n">values</span><span class="p">)</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="n">printable</span> <span class="o">=</span> <span class="s">&#39;&#39;</span>
                            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">values</span><span class="p">:</span>
                                <span class="c"># use lookup table for this tag</span>
                                <span class="n">printable</span> <span class="o">+=</span> <span class="n">tag_entry</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="nb">repr</span><span class="p">(</span><span class="n">i</span><span class="p">))</span>

                <span class="bp">self</span><span class="o">.</span><span class="n">tags</span><span class="p">[</span><span class="n">ifd_name</span> <span class="o">+</span> <span class="s">&#39; &#39;</span> <span class="o">+</span> <span class="n">tag_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">IFD_Tag</span><span class="p">(</span><span class="n">printable</span><span class="p">,</span> <span class="n">tag</span><span class="p">,</span>
                                                          <span class="n">field_type</span><span class="p">,</span>
                                                          <span class="n">values</span><span class="p">,</span> <span class="n">field_offset</span><span class="p">,</span>
                                                          <span class="n">count</span> <span class="o">*</span> <span class="n">typelen</span><span class="p">)</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">debug</span><span class="p">:</span>
                    <span class="k">print</span> <span class="s">&#39; debug:   </span><span class="si">%s</span><span class="s">: </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">tag_name</span><span class="p">,</span>
                                                <span class="nb">repr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tags</span><span class="p">[</span><span class="n">ifd_name</span> <span class="o">+</span> <span class="s">&#39; &#39;</span> <span class="o">+</span> <span class="n">tag_name</span><span class="p">]))</span>

            <span class="k">if</span> <span class="n">tag_name</span> <span class="o">==</span> <span class="n">stop_tag</span><span class="p">:</span>
                <span class="k">break</span>

    <span class="c"># extract uncompressed TIFF thumbnail (like pulling teeth)</span>
    <span class="c"># we take advantage of the pre-existing layout in the thumbnail IFD as</span>
    <span class="c"># much as possible</span></div>
<div class="viewcode-block" id="EXIF_header.extract_TIFF_thumbnail"><a class="viewcode-back" href="../../../../pytomo.kaa_metadata.image.html#pytomo.kaa_metadata.image.EXIF.EXIF_header.extract_TIFF_thumbnail">[docs]</a>    <span class="k">def</span> <span class="nf">extract_TIFF_thumbnail</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">thumb_ifd</span><span class="p">):</span>
        <span class="n">entries</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">s2n</span><span class="p">(</span><span class="n">thumb_ifd</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
        <span class="c"># this is header plus offset to IFD ...</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">endian</span> <span class="o">==</span> <span class="s">&#39;M&#39;</span><span class="p">:</span>
            <span class="n">tiff</span> <span class="o">=</span> <span class="s">&#39;MM</span><span class="se">\x00</span><span class="s">*</span><span class="se">\x00\x00\x00\x08</span><span class="s">&#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">tiff</span> <span class="o">=</span> <span class="s">&#39;II*</span><span class="se">\x00\x08\x00\x00\x00</span><span class="s">&#39;</span>
        <span class="c"># ... plus thumbnail IFD data plus a null &quot;next IFD&quot; pointer</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">file</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">offset</span><span class="o">+</span><span class="n">thumb_ifd</span><span class="p">)</span>
        <span class="n">tiff</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">file</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">entries</span><span class="o">*</span><span class="mi">12</span><span class="o">+</span><span class="mi">2</span><span class="p">)</span><span class="o">+</span><span class="s">&#39;</span><span class="se">\x00\x00\x00\x00</span><span class="s">&#39;</span>

        <span class="c"># fix up large value offset pointers into data area</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">entries</span><span class="p">):</span>
            <span class="n">entry</span> <span class="o">=</span> <span class="n">thumb_ifd</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">+</span> <span class="mi">12</span> <span class="o">*</span> <span class="n">i</span>
            <span class="n">tag</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">s2n</span><span class="p">(</span><span class="n">entry</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
            <span class="n">field_type</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">s2n</span><span class="p">(</span><span class="n">entry</span><span class="o">+</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
            <span class="n">typelen</span> <span class="o">=</span> <span class="n">FIELD_TYPES</span><span class="p">[</span><span class="n">field_type</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">count</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">s2n</span><span class="p">(</span><span class="n">entry</span><span class="o">+</span><span class="mi">4</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>
            <span class="n">oldoff</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">s2n</span><span class="p">(</span><span class="n">entry</span><span class="o">+</span><span class="mi">8</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>
            <span class="c"># start of the 4-byte pointer area in entry</span>
            <span class="n">ptr</span> <span class="o">=</span> <span class="n">i</span> <span class="o">*</span> <span class="mi">12</span> <span class="o">+</span> <span class="mi">18</span>
            <span class="c"># remember strip offsets location</span>
            <span class="k">if</span> <span class="n">tag</span> <span class="o">==</span> <span class="mh">0x0111</span><span class="p">:</span>
                <span class="n">strip_off</span> <span class="o">=</span> <span class="n">ptr</span>
                <span class="n">strip_len</span> <span class="o">=</span> <span class="n">count</span> <span class="o">*</span> <span class="n">typelen</span>
            <span class="c"># is it in the data area?</span>
            <span class="k">if</span> <span class="n">count</span> <span class="o">*</span> <span class="n">typelen</span> <span class="o">&gt;</span> <span class="mi">4</span><span class="p">:</span>
                <span class="c"># update offset pointer (nasty &quot;strings are immutable&quot; crap)</span>
                <span class="c"># should be able to say &quot;tiff[ptr:ptr+4]=newoff&quot;</span>
                <span class="n">newoff</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">tiff</span><span class="p">)</span>
                <span class="n">tiff</span> <span class="o">=</span> <span class="n">tiff</span><span class="p">[:</span><span class="n">ptr</span><span class="p">]</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">n2s</span><span class="p">(</span><span class="n">newoff</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span> <span class="o">+</span> <span class="n">tiff</span><span class="p">[</span><span class="n">ptr</span><span class="o">+</span><span class="mi">4</span><span class="p">:]</span>
                <span class="c"># remember strip offsets location</span>
                <span class="k">if</span> <span class="n">tag</span> <span class="o">==</span> <span class="mh">0x0111</span><span class="p">:</span>
                    <span class="n">strip_off</span> <span class="o">=</span> <span class="n">newoff</span>
                    <span class="n">strip_len</span> <span class="o">=</span> <span class="mi">4</span>
                <span class="c"># get original data and store it</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">file</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">offset</span> <span class="o">+</span> <span class="n">oldoff</span><span class="p">)</span>
                <span class="n">tiff</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">file</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">count</span> <span class="o">*</span> <span class="n">typelen</span><span class="p">)</span>

        <span class="c"># add pixel strips and update strip offset info</span>
        <span class="c"># kaa_metadata addition: wrap key access in try/except in case</span>
        <span class="c"># keys do not exist, in which case we cannot extract TIFF thumbnail</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">old_offsets</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tags</span><span class="p">[</span><span class="s">&#39;Thumbnail StripOffsets&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
            <span class="n">old_counts</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tags</span><span class="p">[</span><span class="s">&#39;Thumbnail StripByteCounts&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
            <span class="k">return</span>

        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">old_offsets</span><span class="p">)):</span>
            <span class="c"># update offset pointer (more nasty &quot;strings are immutable&quot; crap)</span>
            <span class="n">offset</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">n2s</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">tiff</span><span class="p">),</span> <span class="n">strip_len</span><span class="p">)</span>
            <span class="n">tiff</span> <span class="o">=</span> <span class="n">tiff</span><span class="p">[:</span><span class="n">strip_off</span><span class="p">]</span> <span class="o">+</span> <span class="n">offset</span> <span class="o">+</span> <span class="n">tiff</span><span class="p">[</span><span class="n">strip_off</span> <span class="o">+</span> <span class="n">strip_len</span><span class="p">:]</span>
            <span class="n">strip_off</span> <span class="o">+=</span> <span class="n">strip_len</span>
            <span class="c"># add pixel strip to end</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">file</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">offset</span> <span class="o">+</span> <span class="n">old_offsets</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
            <span class="n">tiff</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">file</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">old_counts</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">tags</span><span class="p">[</span><span class="s">&#39;TIFFThumbnail&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">tiff</span>

    <span class="c"># decode all the camera-specific MakerNote formats</span>

    <span class="c"># Note is the data that comprises this MakerNote.  The MakerNote will</span>
    <span class="c"># likely have pointers in it that point to other parts of the file.  We&#39;ll</span>
    <span class="c"># use self.offset as the starting point for most of those pointers, since</span>
    <span class="c"># they are relative to the beginning of the file.</span>
    <span class="c">#</span>
    <span class="c"># If the MakerNote is in a newer format, it may use relative addressing</span>
    <span class="c"># within the MakerNote.  In that case we&#39;ll use relative addresses for the</span>
    <span class="c"># pointers.</span>
    <span class="c">#</span>
    <span class="c"># As an aside: it&#39;s not just to be annoying that the manufacturers use</span>
    <span class="c"># relative offsets.  It&#39;s so that if the makernote has to be moved by the</span>
    <span class="c"># picture software all of the offsets don&#39;t have to be adjusted.  Overall,</span>
    <span class="c"># this is probably the right strategy for makernotes, though the spec is</span>
    <span class="c"># ambiguous.  (The spec does not appear to imagine that makernotes would</span>
    <span class="c"># follow EXIF format internally.  Once they did, it&#39;s ambiguous whether</span>
    <span class="c"># the offsets should be from the header at the start of all the EXIF info,</span>
    <span class="c"># or from the header at the start of the makernote.)</span></div>
<div class="viewcode-block" id="EXIF_header.decode_maker_note"><a class="viewcode-back" href="../../../../pytomo.kaa_metadata.image.html#pytomo.kaa_metadata.image.EXIF.EXIF_header.decode_maker_note">[docs]</a>    <span class="k">def</span> <span class="nf">decode_maker_note</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">note</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tags</span><span class="p">[</span><span class="s">&#39;EXIF MakerNote&#39;</span><span class="p">]</span>
        <span class="n">make</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tags</span><span class="p">[</span><span class="s">&#39;Image Make&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">printable</span>
        <span class="c"># model = self.tags[&#39;Image Model&#39;].printable # unused</span>

        <span class="c"># Nikon</span>
        <span class="c"># The maker note usually starts with the word Nikon, followed by the</span>
        <span class="c"># type of the makernote (1 or 2, as a short).  If the word Nikon is</span>
        <span class="c"># not at the start of the makernote, it&#39;s probably type 2, since some</span>
        <span class="c"># cameras work that way.</span>
        <span class="k">if</span> <span class="n">make</span> <span class="ow">in</span> <span class="p">(</span><span class="s">&#39;NIKON&#39;</span><span class="p">,</span> <span class="s">&#39;NIKON CORPORATION&#39;</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">note</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">7</span><span class="p">]</span> <span class="o">==</span> <span class="p">[</span><span class="mi">78</span><span class="p">,</span> <span class="mi">105</span><span class="p">,</span> <span class="mi">107</span><span class="p">,</span> <span class="mi">111</span><span class="p">,</span> <span class="mi">110</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]:</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">debug</span><span class="p">:</span>
                    <span class="k">print</span> <span class="s">&quot;Looks like a type 1 Nikon MakerNote.&quot;</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">dump_IFD</span><span class="p">(</span><span class="n">note</span><span class="o">.</span><span class="n">field_offset</span><span class="o">+</span><span class="mi">8</span><span class="p">,</span> <span class="s">&#39;MakerNote&#39;</span><span class="p">,</span>
                              <span class="nb">dict</span><span class="o">=</span><span class="n">MAKERNOTE_NIKON_OLDER_TAGS</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">note</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">7</span><span class="p">]</span> <span class="o">==</span> <span class="p">[</span><span class="mi">78</span><span class="p">,</span> <span class="mi">105</span><span class="p">,</span> <span class="mi">107</span><span class="p">,</span> <span class="mi">111</span><span class="p">,</span> <span class="mi">110</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">]:</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">debug</span><span class="p">:</span>
                    <span class="k">print</span> <span class="s">&quot;Looks like a labeled type 2 Nikon MakerNote&quot;</span>
                <span class="k">if</span> <span class="n">note</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">12</span><span class="p">:</span><span class="mi">14</span><span class="p">]</span> <span class="o">!=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">42</span><span class="p">]</span> <span class="ow">and</span> <span class="n">note</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">12</span><span class="p">:</span><span class="mi">14</span><span class="p">]</span> <span class="o">!=</span> <span class="p">[</span><span class="il">42L</span><span class="p">,</span> <span class="il">0L</span><span class="p">]:</span>
                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s">&quot;Missing marker tag &#39;42&#39; in MakerNote.&quot;</span><span class="p">)</span>
                <span class="c"># skip the Makernote label and the TIFF header</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">dump_IFD</span><span class="p">(</span><span class="n">note</span><span class="o">.</span><span class="n">field_offset</span><span class="o">+</span><span class="mi">10</span><span class="o">+</span><span class="mi">8</span><span class="p">,</span> <span class="s">&#39;MakerNote&#39;</span><span class="p">,</span>
                              <span class="nb">dict</span><span class="o">=</span><span class="n">MAKERNOTE_NIKON_NEWER_TAGS</span><span class="p">,</span> <span class="n">relative</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c"># E99x or D1</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">debug</span><span class="p">:</span>
                    <span class="k">print</span> <span class="s">&quot;Looks like an unlabeled type 2 Nikon MakerNote&quot;</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">dump_IFD</span><span class="p">(</span><span class="n">note</span><span class="o">.</span><span class="n">field_offset</span><span class="p">,</span> <span class="s">&#39;MakerNote&#39;</span><span class="p">,</span>
                              <span class="nb">dict</span><span class="o">=</span><span class="n">MAKERNOTE_NIKON_NEWER_TAGS</span><span class="p">)</span>
            <span class="k">return</span>

        <span class="c"># Olympus</span>
        <span class="k">if</span> <span class="n">make</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s">&#39;OLYMPUS&#39;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">dump_IFD</span><span class="p">(</span><span class="n">note</span><span class="o">.</span><span class="n">field_offset</span><span class="o">+</span><span class="mi">8</span><span class="p">,</span> <span class="s">&#39;MakerNote&#39;</span><span class="p">,</span>
                          <span class="nb">dict</span><span class="o">=</span><span class="n">MAKERNOTE_OLYMPUS_TAGS</span><span class="p">)</span>
            <span class="c"># TODO</span>
            <span class="c">#for i in ((&#39;MakerNote Tag 0x2020&#39;, MAKERNOTE_OLYMPUS_TAG_0x2020),):</span>
            <span class="c">#    self.decode_olympus_tag(self.tags[i[0]].values, i[1])</span>
            <span class="c">#return</span>

        <span class="c"># Casio</span>
        <span class="k">if</span> <span class="n">make</span> <span class="o">==</span> <span class="s">&#39;Casio&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">dump_IFD</span><span class="p">(</span><span class="n">note</span><span class="o">.</span><span class="n">field_offset</span><span class="p">,</span> <span class="s">&#39;MakerNote&#39;</span><span class="p">,</span>
                          <span class="nb">dict</span><span class="o">=</span><span class="n">MAKERNOTE_CASIO_TAGS</span><span class="p">)</span>
            <span class="k">return</span>

        <span class="c"># Fujifilm</span>
        <span class="k">if</span> <span class="n">make</span> <span class="o">==</span> <span class="s">&#39;FUJIFILM&#39;</span><span class="p">:</span>
            <span class="c"># bug: everything else is &quot;Motorola&quot; endian, but the MakerNote</span>
            <span class="c"># is &quot;Intel&quot; endian</span>
            <span class="n">endian</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">endian</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">endian</span> <span class="o">=</span> <span class="s">&#39;I&#39;</span>
            <span class="c"># bug: IFD offsets are from beginning of MakerNote, not</span>
            <span class="c"># beginning of file header</span>
            <span class="n">offset</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">offset</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">offset</span> <span class="o">+=</span> <span class="n">note</span><span class="o">.</span><span class="n">field_offset</span>
            <span class="c"># process note with bogus values (note is actually at offset 12)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">dump_IFD</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="s">&#39;MakerNote&#39;</span><span class="p">,</span> <span class="nb">dict</span><span class="o">=</span><span class="n">MAKERNOTE_FUJIFILM_TAGS</span><span class="p">)</span>
            <span class="c"># reset to correct values</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">endian</span> <span class="o">=</span> <span class="n">endian</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">offset</span> <span class="o">=</span> <span class="n">offset</span>
            <span class="k">return</span>

        <span class="c"># Canon</span>
        <span class="k">if</span> <span class="n">make</span> <span class="o">==</span> <span class="s">&#39;Canon&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">dump_IFD</span><span class="p">(</span><span class="n">note</span><span class="o">.</span><span class="n">field_offset</span><span class="p">,</span> <span class="s">&#39;MakerNote&#39;</span><span class="p">,</span>
                          <span class="nb">dict</span><span class="o">=</span><span class="n">MAKERNOTE_CANON_TAGS</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="p">((</span><span class="s">&#39;MakerNote Tag 0x0001&#39;</span><span class="p">,</span> <span class="n">MAKERNOTE_CANON_TAG_0x001</span><span class="p">),</span>
                      <span class="p">(</span><span class="s">&#39;MakerNote Tag 0x0004&#39;</span><span class="p">,</span> <span class="n">MAKERNOTE_CANON_TAG_0x004</span><span class="p">)):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">canon_decode_tag</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tags</span><span class="p">[</span><span class="n">i</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="n">i</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
            <span class="k">return</span>

    <span class="c"># decode Olympus MakerNote tag based on offset within tag</span></div>
<div class="viewcode-block" id="EXIF_header.olympus_decode_tag"><a class="viewcode-back" href="../../../../pytomo.kaa_metadata.image.html#pytomo.kaa_metadata.image.EXIF.EXIF_header.olympus_decode_tag">[docs]</a>    <span class="k">def</span> <span class="nf">olympus_decode_tag</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
        <span class="k">pass</span>

    <span class="c"># decode Canon MakerNote tag based on offset within tag</span>
    <span class="c"># see http://www.burren.cx/david/canon.html by David Burren</span></div>
<div class="viewcode-block" id="EXIF_header.canon_decode_tag"><a class="viewcode-back" href="../../../../pytomo.kaa_metadata.image.html#pytomo.kaa_metadata.image.EXIF.EXIF_header.canon_decode_tag">[docs]</a>    <span class="k">def</span> <span class="nf">canon_decode_tag</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">value</span><span class="p">)):</span>
            <span class="n">x</span><span class="o">=</span><span class="nb">dict</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="p">(</span><span class="s">&#39;Unknown&#39;</span><span class="p">,</span> <span class="p">))</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">debug</span><span class="p">:</span>
                <span class="k">print</span> <span class="n">i</span><span class="p">,</span> <span class="n">x</span>
            <span class="n">name</span><span class="o">=</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">val</span><span class="o">=</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">value</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="s">&#39;Unknown&#39;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">val</span><span class="o">=</span><span class="n">value</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
            <span class="c"># it&#39;s not a real IFD Tag but we fake one to make everybody</span>
            <span class="c"># happy. this will have a &quot;proprietary&quot; type</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">tags</span><span class="p">[</span><span class="s">&#39;MakerNote &#39;</span><span class="o">+</span><span class="n">name</span><span class="p">]</span><span class="o">=</span><span class="n">IFD_Tag</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">val</span><span class="p">),</span> <span class="bp">None</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="bp">None</span><span class="p">,</span>
                                                 <span class="bp">None</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>

<span class="c"># process an image file (expects an open file object)</span>
<span class="c"># this is the function that has to deal with all the arbitrary nasty bits</span>
<span class="c"># of the EXIF standard</span></div></div>
<div class="viewcode-block" id="process_file"><a class="viewcode-back" href="../../../../pytomo.kaa_metadata.image.html#pytomo.kaa_metadata.image.EXIF.process_file">[docs]</a><span class="k">def</span> <span class="nf">process_file</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">stop_tag</span><span class="o">=</span><span class="s">&#39;UNDEF&#39;</span><span class="p">,</span> <span class="n">details</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">debug</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
    <span class="c"># yah it&#39;s cheesy...</span>
    <span class="k">global</span> <span class="n">detailed</span>
    <span class="n">detailed</span> <span class="o">=</span> <span class="n">details</span>

    <span class="c"># by default do not fake an EXIF beginning</span>
    <span class="n">fake_exif</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="c"># determine whether it&#39;s a JPEG or TIFF</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="mi">12</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">4</span><span class="p">]</span> <span class="ow">in</span> <span class="p">[</span><span class="s">&#39;II*</span><span class="se">\x00</span><span class="s">&#39;</span><span class="p">,</span> <span class="s">&#39;MM</span><span class="se">\x00</span><span class="s">*&#39;</span><span class="p">]:</span>
        <span class="c"># it&#39;s a TIFF file</span>
        <span class="n">f</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">endian</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">offset</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">elif</span> <span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">2</span><span class="p">]</span> <span class="o">==</span> <span class="s">&#39;</span><span class="se">\xFF\xD8</span><span class="s">&#39;</span><span class="p">:</span>
        <span class="c"># it&#39;s a JPEG file</span>
        <span class="k">while</span> <span class="n">data</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">==</span> <span class="s">&#39;</span><span class="se">\xFF</span><span class="s">&#39;</span> <span class="ow">and</span> <span class="n">data</span><span class="p">[</span><span class="mi">6</span><span class="p">:</span><span class="mi">10</span><span class="p">]</span> <span class="ow">in</span> <span class="p">(</span><span class="s">&#39;JFIF&#39;</span><span class="p">,</span> <span class="s">&#39;JFXX&#39;</span><span class="p">,</span> <span class="s">&#39;OLYM&#39;</span><span class="p">,</span> <span class="s">&#39;Phot&#39;</span><span class="p">):</span>
            <span class="n">length</span> <span class="o">=</span> <span class="nb">ord</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">4</span><span class="p">])</span><span class="o">*</span><span class="mi">256</span><span class="o">+</span><span class="nb">ord</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">5</span><span class="p">])</span>
            <span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">length</span><span class="o">-</span><span class="mi">8</span><span class="p">)</span>
            <span class="c"># fake an EXIF beginning of file</span>
            <span class="n">data</span> <span class="o">=</span> <span class="s">&#39;</span><span class="se">\xFF\x00</span><span class="s">&#39;</span><span class="o">+</span><span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
            <span class="n">fake_exif</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="k">if</span> <span class="n">data</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">==</span> <span class="s">&#39;</span><span class="se">\xFF</span><span class="s">&#39;</span> <span class="ow">and</span> <span class="n">data</span><span class="p">[</span><span class="mi">6</span><span class="p">:</span><span class="mi">10</span><span class="p">]</span> <span class="o">==</span> <span class="s">&#39;Exif&#39;</span><span class="p">:</span>
            <span class="c"># detected EXIF header</span>
            <span class="n">offset</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">tell</span><span class="p">()</span>
            <span class="n">endian</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c"># no EXIF information</span>
            <span class="k">return</span> <span class="p">{}</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c"># file format not recognized</span>
        <span class="k">return</span> <span class="p">{}</span>

    <span class="c"># deal with the EXIF info we found</span>
    <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
        <span class="k">print</span> <span class="p">{</span><span class="s">&#39;I&#39;</span><span class="p">:</span> <span class="s">&#39;Intel&#39;</span><span class="p">,</span> <span class="s">&#39;M&#39;</span><span class="p">:</span> <span class="s">&#39;Motorola&#39;</span><span class="p">}[</span><span class="n">endian</span><span class="p">],</span> <span class="s">&#39;format&#39;</span>
    <span class="n">hdr</span> <span class="o">=</span> <span class="n">EXIF_header</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">endian</span><span class="p">,</span> <span class="n">offset</span><span class="p">,</span> <span class="n">fake_exif</span><span class="p">,</span> <span class="n">debug</span><span class="p">)</span>
    <span class="n">ifd_list</span> <span class="o">=</span> <span class="n">hdr</span><span class="o">.</span><span class="n">list_IFDs</span><span class="p">()</span>
    <span class="n">ctr</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">ifd_list</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">ctr</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">IFD_name</span> <span class="o">=</span> <span class="s">&#39;Image&#39;</span>
        <span class="k">elif</span> <span class="n">ctr</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">IFD_name</span> <span class="o">=</span> <span class="s">&#39;Thumbnail&#39;</span>
            <span class="n">thumb_ifd</span> <span class="o">=</span> <span class="n">i</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">IFD_name</span> <span class="o">=</span> <span class="s">&#39;IFD </span><span class="si">%d</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">ctr</span>
        <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
            <span class="k">print</span> <span class="s">&#39; IFD </span><span class="si">%d</span><span class="s"> (</span><span class="si">%s</span><span class="s">) at offset </span><span class="si">%d</span><span class="s">:&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">ctr</span><span class="p">,</span> <span class="n">IFD_name</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span>
        <span class="n">hdr</span><span class="o">.</span><span class="n">dump_IFD</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">IFD_name</span><span class="p">,</span> <span class="n">stop_tag</span><span class="o">=</span><span class="n">stop_tag</span><span class="p">)</span>
        <span class="c"># EXIF IFD</span>
        <span class="n">exif_off</span> <span class="o">=</span> <span class="n">hdr</span><span class="o">.</span><span class="n">tags</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">IFD_name</span><span class="o">+</span><span class="s">&#39; ExifOffset&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">exif_off</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
                <span class="k">print</span> <span class="s">&#39; EXIF SubIFD at offset </span><span class="si">%d</span><span class="s">:&#39;</span> <span class="o">%</span> <span class="n">exif_off</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">hdr</span><span class="o">.</span><span class="n">dump_IFD</span><span class="p">(</span><span class="n">exif_off</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="s">&#39;EXIF&#39;</span><span class="p">,</span> <span class="n">stop_tag</span><span class="o">=</span><span class="n">stop_tag</span><span class="p">)</span>
            <span class="c"># Interoperability IFD contained in EXIF IFD</span>
            <span class="n">intr_off</span> <span class="o">=</span> <span class="n">hdr</span><span class="o">.</span><span class="n">tags</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;EXIF SubIFD InteroperabilityOffset&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">intr_off</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
                    <span class="k">print</span> <span class="s">&#39; EXIF Interoperability SubSubIFD at offset </span><span class="si">%d</span><span class="s">:&#39;</span> \
                          <span class="o">%</span> <span class="n">intr_off</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">hdr</span><span class="o">.</span><span class="n">dump_IFD</span><span class="p">(</span><span class="n">intr_off</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="s">&#39;EXIF Interoperability&#39;</span><span class="p">,</span>
                             <span class="nb">dict</span><span class="o">=</span><span class="n">INTR_TAGS</span><span class="p">,</span> <span class="n">stop_tag</span><span class="o">=</span><span class="n">stop_tag</span><span class="p">)</span>
        <span class="c"># GPS IFD</span>
        <span class="n">gps_off</span> <span class="o">=</span> <span class="n">hdr</span><span class="o">.</span><span class="n">tags</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">IFD_name</span><span class="o">+</span><span class="s">&#39; GPSInfo&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">gps_off</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
                <span class="k">print</span> <span class="s">&#39; GPS SubIFD at offset </span><span class="si">%d</span><span class="s">:&#39;</span> <span class="o">%</span> <span class="n">gps_off</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">hdr</span><span class="o">.</span><span class="n">dump_IFD</span><span class="p">(</span><span class="n">gps_off</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="s">&#39;GPS&#39;</span><span class="p">,</span> <span class="nb">dict</span><span class="o">=</span><span class="n">GPS_TAGS</span><span class="p">,</span> <span class="n">stop_tag</span><span class="o">=</span><span class="n">stop_tag</span><span class="p">)</span>
        <span class="n">ctr</span> <span class="o">+=</span> <span class="mi">1</span>

    <span class="c"># extract uncompressed TIFF thumbnail</span>
    <span class="n">thumb</span> <span class="o">=</span> <span class="n">hdr</span><span class="o">.</span><span class="n">tags</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;Thumbnail Compression&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">thumb</span> <span class="ow">and</span> <span class="n">thumb</span><span class="o">.</span><span class="n">printable</span> <span class="o">==</span> <span class="s">&#39;Uncompressed TIFF&#39;</span><span class="p">:</span>
        <span class="n">hdr</span><span class="o">.</span><span class="n">extract_TIFF_thumbnail</span><span class="p">(</span><span class="n">thumb_ifd</span><span class="p">)</span>

    <span class="c"># JPEG thumbnail (thankfully the JPEG data is stored as a unit)</span>
    <span class="n">thumb_off</span> <span class="o">=</span> <span class="n">hdr</span><span class="o">.</span><span class="n">tags</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;Thumbnail JPEGInterchangeFormat&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">thumb_off</span><span class="p">:</span>
        <span class="n">f</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="n">offset</span><span class="o">+</span><span class="n">thumb_off</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">size</span> <span class="o">=</span> <span class="n">hdr</span><span class="o">.</span><span class="n">tags</span><span class="p">[</span><span class="s">&#39;Thumbnail JPEGInterchangeFormatLength&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">hdr</span><span class="o">.</span><span class="n">tags</span><span class="p">[</span><span class="s">&#39;JPEGThumbnail&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">size</span><span class="p">)</span>

    <span class="c"># deal with MakerNote contained in EXIF IFD</span>
    <span class="c"># kaa_metadata addition: also test &#39;Image Make&#39; in hdr.tags before</span>
    <span class="c"># calling decode_maker_note().</span>
    <span class="k">if</span> <span class="s">&#39;EXIF MakerNote&#39;</span> <span class="ow">in</span> <span class="n">hdr</span><span class="o">.</span><span class="n">tags</span> <span class="ow">and</span> <span class="s">&#39;Image Make&#39;</span> <span class="ow">in</span> <span class="n">hdr</span><span class="o">.</span><span class="n">tags</span> <span class="ow">and</span> <span class="n">detailed</span><span class="p">:</span>
        <span class="n">hdr</span><span class="o">.</span><span class="n">decode_maker_note</span><span class="p">()</span>

    <span class="c"># Sometimes in a TIFF file, a JPEG thumbnail is hidden in the MakerNote</span>
    <span class="c"># since it&#39;s not allowed in a uncompressed TIFF IFD</span>
    <span class="k">if</span> <span class="s">&#39;JPEGThumbnail&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">hdr</span><span class="o">.</span><span class="n">tags</span><span class="p">:</span>
        <span class="n">thumb_off</span><span class="o">=</span><span class="n">hdr</span><span class="o">.</span><span class="n">tags</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;MakerNote JPEGThumbnail&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">thumb_off</span><span class="p">:</span>
            <span class="n">f</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="n">offset</span><span class="o">+</span><span class="n">thumb_off</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="n">hdr</span><span class="o">.</span><span class="n">tags</span><span class="p">[</span><span class="s">&#39;JPEGThumbnail&#39;</span><span class="p">]</span><span class="o">=</span><span class="nb">file</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">thumb_off</span><span class="o">.</span><span class="n">field_length</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">hdr</span><span class="o">.</span><span class="n">tags</span>


<span class="c"># show command line usage</span></div>
<div class="viewcode-block" id="usage"><a class="viewcode-back" href="../../../../pytomo.kaa_metadata.image.html#pytomo.kaa_metadata.image.EXIF.usage">[docs]</a><span class="k">def</span> <span class="nf">usage</span><span class="p">(</span><span class="n">exit_status</span><span class="p">):</span>
    <span class="n">msg</span> <span class="o">=</span> <span class="s">&#39;Usage: EXIF.py [OPTIONS] file1 [file2 ...]</span><span class="se">\n</span><span class="s">&#39;</span>
    <span class="n">msg</span> <span class="o">+=</span> <span class="s">&#39;Extract EXIF information from digital camera image files.</span><span class="se">\n\n</span><span class="s">Options:</span><span class="se">\n</span><span class="s">&#39;</span>
    <span class="n">msg</span> <span class="o">+=</span> <span class="s">&#39;-q --quick   Do not process MakerNotes.</span><span class="se">\n</span><span class="s">&#39;</span>
    <span class="n">msg</span> <span class="o">+=</span> <span class="s">&#39;-t TAG --stop-tag TAG   Stop processing when this tag is retrieved.</span><span class="se">\n</span><span class="s">&#39;</span>
    <span class="n">msg</span> <span class="o">+=</span> <span class="s">&#39;-d --debug   Run in debug mode.</span><span class="se">\n</span><span class="s">&#39;</span>
    <span class="k">print</span> <span class="n">msg</span>
    <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="n">exit_status</span><span class="p">)</span>

<span class="c"># library test/debug function (dump given files)</span></div>
<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="kn">import</span> <span class="nn">sys</span>
    <span class="kn">import</span> <span class="nn">getopt</span>

    <span class="c"># parse command line options/arguments</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">opts</span><span class="p">,</span> <span class="n">args</span> <span class="o">=</span> <span class="n">getopt</span><span class="o">.</span><span class="n">getopt</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">:],</span> <span class="s">&quot;hqdt:v&quot;</span><span class="p">,</span> <span class="p">[</span><span class="s">&quot;help&quot;</span><span class="p">,</span> <span class="s">&quot;quick&quot;</span><span class="p">,</span> <span class="s">&quot;debug&quot;</span><span class="p">,</span> <span class="s">&quot;stop-tag=&quot;</span><span class="p">])</span>
    <span class="k">except</span> <span class="n">getopt</span><span class="o">.</span><span class="n">GetoptError</span><span class="p">:</span>
        <span class="n">usage</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">args</span> <span class="o">==</span> <span class="p">[]:</span>
        <span class="n">usage</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
    <span class="n">detailed</span> <span class="o">=</span> <span class="bp">True</span>
    <span class="n">stop_tag</span> <span class="o">=</span> <span class="s">&#39;UNDEF&#39;</span>
    <span class="n">debug</span> <span class="o">=</span> <span class="bp">False</span>
    <span class="k">for</span> <span class="n">o</span><span class="p">,</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">opts</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">o</span> <span class="ow">in</span> <span class="p">(</span><span class="s">&quot;-h&quot;</span><span class="p">,</span> <span class="s">&quot;--help&quot;</span><span class="p">):</span>
            <span class="n">usage</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">o</span> <span class="ow">in</span> <span class="p">(</span><span class="s">&quot;-q&quot;</span><span class="p">,</span> <span class="s">&quot;--quick&quot;</span><span class="p">):</span>
            <span class="n">detailed</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="k">if</span> <span class="n">o</span> <span class="ow">in</span> <span class="p">(</span><span class="s">&quot;-t&quot;</span><span class="p">,</span> <span class="s">&quot;--stop-tag&quot;</span><span class="p">):</span>
            <span class="n">stop_tag</span> <span class="o">=</span> <span class="n">a</span>
        <span class="k">if</span> <span class="n">o</span> <span class="ow">in</span> <span class="p">(</span><span class="s">&quot;-d&quot;</span><span class="p">,</span> <span class="s">&quot;--debug&quot;</span><span class="p">):</span>
            <span class="n">debug</span> <span class="o">=</span> <span class="bp">True</span>

    <span class="c"># output info for each file</span>
    <span class="k">for</span> <span class="n">filename</span> <span class="ow">in</span> <span class="n">args</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="nb">file</span><span class="o">=</span><span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s">&#39;rb&#39;</span><span class="p">)</span>
        <span class="k">except</span> <span class="p">(</span><span class="ne">IOError</span><span class="p">,</span> <span class="ne">OSError</span><span class="p">):</span>
            <span class="k">print</span> <span class="s">&quot;&#39;</span><span class="si">%s</span><span class="s">&#39; is unreadable</span><span class="se">\n</span><span class="s">&quot;</span><span class="o">%</span><span class="n">filename</span>
            <span class="k">continue</span>
        <span class="k">print</span> <span class="n">filename</span> <span class="o">+</span> <span class="s">&#39;:&#39;</span>
        <span class="c"># get the tags</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">process_file</span><span class="p">(</span><span class="nb">file</span><span class="p">,</span> <span class="n">stop_tag</span><span class="o">=</span><span class="n">stop_tag</span><span class="p">,</span> <span class="n">details</span><span class="o">=</span><span class="n">detailed</span><span class="p">,</span> <span class="n">debug</span><span class="o">=</span><span class="n">debug</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">data</span><span class="p">:</span>
            <span class="k">print</span> <span class="s">&#39;No EXIF information found&#39;</span>
            <span class="k">continue</span>

        <span class="n">x</span><span class="o">=</span><span class="n">data</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
        <span class="n">x</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">x</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">i</span> <span class="ow">in</span> <span class="p">(</span><span class="s">&#39;JPEGThumbnail&#39;</span><span class="p">,</span> <span class="s">&#39;TIFFThumbnail&#39;</span><span class="p">):</span>
                <span class="k">continue</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">print</span> <span class="s">&#39;   </span><span class="si">%s</span><span class="s"> (</span><span class="si">%s</span><span class="s">): </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> \
                      <span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">FIELD_TYPES</span><span class="p">[</span><span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">field_type</span><span class="p">][</span><span class="mi">2</span><span class="p">],</span> <span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">printable</span><span class="p">)</span>
            <span class="k">except</span> <span class="p">(</span><span class="ne">KeyError</span><span class="p">,</span> <span class="ne">IndexError</span><span class="p">):</span>
                <span class="k">print</span> <span class="s">&#39;error&#39;</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="s">&#39;&quot;&#39;</span><span class="p">,</span> <span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="s">&#39;&quot;&#39;</span>
        <span class="k">if</span> <span class="s">&#39;JPEGThumbnail&#39;</span> <span class="ow">in</span> <span class="n">data</span><span class="p">:</span>
            <span class="k">print</span> <span class="s">&#39;File has JPEG thumbnail&#39;</span>
        <span class="k">print</span>
</pre></div>

          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="../../../../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../../../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li><a href="../../../../index.html">Pytomo 2.8.6 documentation</a> &raquo;</li>
          <li><a href="../../../index.html" >Module code</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2012, Louis Plissoneau.
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.1.3.
    </div>
  </body>
</html>